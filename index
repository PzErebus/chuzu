/* eslint-disable */
export default {
  async fetch(request) {
    const html = `<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <meta name="cf-beacon" content="off">
  <title>è„šæ‰‹æ¶ç®¡å®¶</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vant@4.6.0/lib/index.css">
  <script src="https://cdn.jsdelivr.net/npm/vue@3.3.4/dist/vue.global.prod.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vant@4.6.0/lib/vant.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <style>
    :root {
      --van-primary-color: #1989fa;
      --bg-color: #f5f7fa;
      --card-bg: #ffffff;
      --text-primary: #323233;
      --text-secondary: #646566;
      --text-muted: #969799;
      --border-color: #ebedf0;
      --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
      --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
      --shadow-lg: 0 8px 24px rgba(0,0,0,0.12);
      --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --gradient-success: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      --gradient-warning: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --gradient-info: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      --gradient-orange: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: var(--bg-color);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      -webkit-tap-highlight-color: transparent;
      overflow-x: hidden;
      color: var(--text-primary);
    }
    [v-cloak] { display: none !important; }
    .page-container { min-height: 100vh; padding-bottom: 70px; }
    .fullscreen-page {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: var(--bg-color); z-index: 999;
      overflow-y: auto; padding-bottom: 50px;
      -webkit-overflow-scrolling: touch;
      animation: slideIn 0.3s ease-out;
    }
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }
    .loading-mask {
      position: fixed; top:0; left:0; width:100%; height:100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      z-index: 9999; display: none; justify-content: center; align-items: center;
      flex-direction: column; color: white; font-size: 14px;
    }
    #error-banner {
      display: none; position: fixed; top: 0; left: 0; width: 100%;
      background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%);
      color: white; padding: 12px; text-align: center; z-index: 10000;
      font-size: 13px; font-weight: 500;
    }
    .card-group-title {
      padding: 16px 16px 8px; color: var(--text-muted);
      font-size: 13px; font-weight: 500; letter-spacing: 0.5px;
    }
    .card {
      background: var(--card-bg); border-radius: 16px;
      margin: 8px 12px; padding: 16px;
      box-shadow: var(--shadow-md);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      animation: fadeIn 0.4s ease-out;
    }
    .card:hover { box-shadow: var(--shadow-lg); }
    .card:active { transform: scale(0.98); }
    .admin-card {
      display: flex; align-items: center; justify-content: space-between;
      padding: 18px 16px; margin: 0 0 8px 0;
      background: var(--card-bg); border-radius: 16px;
      box-shadow: var(--shadow-sm);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
    }
    .admin-card:hover { box-shadow: var(--shadow-md); transform: translateY(-2px); }
    .admin-card:active { transform: scale(0.98); }
    .admin-icon-box {
      width: 52px; height: 52px; border-radius: 14px;
      display: flex; align-items: center; justify-content: center;
      margin-right: 14px; font-size: 26px;
      box-shadow: var(--shadow-sm);
    }
    .stat-grid {
      display: grid; grid-template-columns: 1fr 1fr;
      gap: 10px; margin: 12px; padding: 0;
    }
    .stat-card {
      background: var(--gradient-primary);
      color: white; padding: 18px 16px; border-radius: 16px;
      display: flex; flex-direction: column; justify-content: center;
      box-shadow: var(--shadow-md);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative; overflow: hidden;
    }
    .stat-card::before {
      content: ''; position: absolute; top: -50%; right: -50%;
      width: 100%; height: 100%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      pointer-events: none;
    }
    .stat-card:hover { transform: translateY(-3px); box-shadow: var(--shadow-lg); }
    .stat-card:active { transform: scale(0.97); }
    .stat-card.orange { background: var(--gradient-orange); }
    .stat-card.green { background: var(--gradient-success); }
    .stat-card.purple { background: var(--gradient-primary); }
    .stat-card.blue { background: var(--gradient-info); }
    .stat-val { font-size: 26px; font-weight: 700; margin-top: 6px; letter-spacing: -0.5px; }
    .stat-label { font-size: 12px; opacity: 0.9; font-weight: 500; }
    .text-red { color: #ee0a24; font-weight: 600; }
    .text-green { color: #07c160; font-weight: 600; }
    .text-primary { color: var(--text-primary); }
    .text-secondary { color: var(--text-secondary); }
    .rent-input {
      width: 60px; border: none; border-bottom: 2px solid var(--van-primary-color);
      text-align: center; color: var(--van-primary-color); font-weight: 600;
      background: transparent; font-size: 15px;
    }
    .rent-input:focus { border-color: #667eea; }
    .bill-wrapper {
      background: white; padding: 25px; margin: 10px;
      border-radius: 12px; box-shadow: var(--shadow-lg);
    }
    .bill-title {
      text-align: center; font-size: 20px; font-weight: 800;
      margin-bottom: 20px; border-bottom: 2px solid #333;
      padding-bottom: 15px; letter-spacing: 3px;
    }
    .logistics-box {
      display: flex; justify-content: space-between;
      margin-bottom: 15px; font-size: 13px;
      background: #f8f9fa; padding: 14px;
      border-radius: 10px; border: 1px solid var(--border-color);
    }
    .bill-header {
      margin-bottom: 10px; font-size: 14px;
      border-top: 1px dashed #ccc; padding-top: 10px;
    }
    .detail-table {
      width: 100%; border-collapse: collapse;
      font-size: 14px; margin-top: 10px;
    }
    .detail-table th {
      text-align: left; border-bottom: 2px solid #333;
      padding: 10px 4px; font-weight: 700;
    }
    .detail-table td {
      border-bottom: 1px solid #eee;
      padding: 12px 4px; vertical-align: middle;
    }
    .btn-primary {
      background: var(--gradient-primary); border: none;
      color: white; font-weight: 600; border-radius: 12px;
      padding: 12px 24px; transition: all 0.3s;
    }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: var(--shadow-lg); }
    .section-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 16px 16px 8px;
    }
    .section-title {
      font-size: 15px; font-weight: 600; color: var(--text-primary);
      display: flex; align-items: center;
    }
    .section-title::before {
      content: ''; width: 4px; height: 16px;
      background: var(--gradient-primary); border-radius: 2px;
      margin-right: 8px;
    }
    .empty-state {
      text-align: center; padding: 40px 20px;
      color: var(--text-muted);
    }
    .empty-state-icon {
      font-size: 48px; margin-bottom: 12px; opacity: 0.5;
    }
    .badge {
      display: inline-flex; align-items: center;
      padding: 2px 8px; border-radius: 6px;
      font-size: 11px; font-weight: 500;
    }
    .badge-primary { background: #e8f4ff; color: #1989fa; }
    .badge-success { background: #e8f7ed; color: #07c160; }
    .badge-warning { background: #fff7e6; color: #ff976a; }
    .badge-danger { background: #ffebee; color: #ee0a24; }
    @media (max-width: 375px) {
      .stat-val { font-size: 22px; }
      .stat-card { padding: 14px; }
      .admin-card { padding: 14px; }
      .card { margin: 6px 10px; padding: 12px; }
    }
    .touch-feedback { transition: all 0.2s; }
    .touch-feedback:active { opacity: 0.7; transform: scale(0.98); }
    input, textarea {
      -webkit-appearance: none; appearance: none;
      border-radius: 0; font-size: 15px;
    }
    input:focus, textarea:focus { outline: none; }
    .van-nav-bar { background: var(--card-bg) !important; }
    .van-tabbar { background: var(--card-bg) !important; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); }
    .van-cell { padding: 14px 16px !important; }
    .van-field__label { color: var(--text-secondary) !important; }
    .van-button--primary { background: var(--gradient-primary) !important; border: none !important; }
    .van-button--danger { background: var(--gradient-warning) !important; border: none !important; }
    .van-tabs__nav { background: var(--card-bg) !important; }
    .van-popup--bottom { border-radius: 20px 20px 0 0 !important; }
    .van-dialog { border-radius: 16px !important; }
    .van-toast { border-radius: 12px !important; }
    .warning-card {
      background: linear-gradient(135deg, #fff5f5 0%, #ffe0e0 100%);
      border-left: 4px solid #ee0a24;
      margin: 8px 12px; padding: 14px 16px;
      border-radius: 12px; animation: pulse 2s infinite;
    }
    .icon-btn {
      width: 36px; height: 36px; border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      background: #f5f7fa; transition: all 0.2s;
    }
    .icon-btn:hover { background: #e8f4ff; }
    .icon-btn:active { transform: scale(0.9); }
    
    @media (max-width: 768px) {
      .card { margin: 6px 10px; padding: 12px; }
      .admin-card { padding: 14px; }
      .stat-card { padding: 14px; }
      .stat-val { font-size: 22px; }
      .van-cell { padding: 12px 16px !important; }
      .van-button { min-height: 44px; font-size: 16px; }
      .van-field__label { font-size: 15px !important; }
      .van-field__control { font-size: 16px !important; }
      
      .touch-feedback {
        -webkit-tap-highlight-color: rgba(25, 137, 250, 0.1);
        user-select: none;
        -webkit-user-select: none;
      }
      
      .swipe-container {
        overflow-x: auto;
        overflow-y: hidden;
        white-space: nowrap;
        -webkit-overflow-scrolling: touch;
      }
      
      .swipe-item {
        display: inline-block;
        vertical-align: top;
        width: 85%;
        margin-right: 10px;
      }
    }
    
    @media (max-width: 480px) {
      .stat-grid { grid-template-columns: 1fr 1fr; gap: 8px; }
      .stat-card { padding: 12px; }
      .stat-val { font-size: 20px; }
      .admin-card { padding: 12px; }
      .card { margin: 4px 8px; padding: 10px; }
      .section-header { padding: 12px 12px 6px; }
      .section-title { font-size: 14px; }
    }
    
    .gesture-hint {
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 12px;
      z-index: 1000;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .gesture-hint.show {
      opacity: 1;
    }
  </style>
</head>
<body>
  <div id="error-banner">âš ï¸ æ ¸å¿ƒåº“åŠ è½½å¤±è´¥ï¼è¯·å°è¯•åˆ‡æ¢ç½‘ç»œæˆ–å…³é—­æ‹¦æˆªæ’ä»¶ã€‚</div>
  <div id="loading-mask" class="loading-mask" style="display: none;">
    <div style="margin-bottom:15px;"><van-loading type="spinner" color="#fff" size="48px" /></div>
    <div style="font-size:16px;font-weight:500;">ç³»ç»Ÿæ­£åœ¨åˆå§‹åŒ–...</div>
  </div>
  <div id="app" v-cloak>
    <div id="gesture-hint" class="gesture-hint">å·¦å³æ»‘åŠ¨åˆ‡æ¢æ ‡ç­¾</div>
      <div v-show="currentView === 'main'" class="page-container">
        <van-nav-bar :title="sysConfig.sys_name || 'è„šæ‰‹æ¶ç®¡å®¶'" fixed placeholder>
          <template #right>
            <div class="icon-btn" @click="goToPage('admin_auth')">
              <van-icon name="setting-o" size="20" color="#667eea" />
            </div>
          </template>
        </van-nav-bar>
        <van-pull-refresh v-model="refreshing" @refresh="onRefresh" success-text="åˆ·æ–°æˆåŠŸ">
      <div v-show="activeTab === 'home'">
        <div class="stat-grid">
          <div class="stat-card">
            <div class="stat-label">ğŸ’° æ—¥ç§Ÿé‡‘é¢„è®¡</div>
            <div class="stat-val">Â¥ {{ (stats.daily_income || 0).toFixed(2) }}</div>
          </div>
          <div class="stat-card orange">
            <div class="stat-label">ğŸ“¦ åœ¨å¤–ç‰©èµ„æ€»æ•°</div>
            <div class="stat-val">{{ stats.total_out || 0 }}</div>
          </div>
        </div>
        <div v-if="stats.low_stock_count > 0" class="warning-card">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <div style="font-weight: 600; color: #ee0a24;">âš ï¸ åº“å­˜é¢„è­¦</div>
            <div style="color: #ee0a24; font-size: 16px; font-weight: 700;">{{ stats.low_stock_count }} é¡¹ç‰©èµ„åº“å­˜ä¸è¶³</div>
          </div>
        </div>
        <div class="section-header">
          <div class="section-title">èµ„äº§åˆ†å¸ƒ</div>
        </div>
        <div class="card" style="margin-top:0"><div id="chart-pie" style="width:100%;height:220px;"></div></div>
        <div class="section-header">
          <div class="section-title">æœ€è¿‘ä¸šåŠ¡</div>
        </div>
        <div class="card" style="padding:0; margin-top:0; overflow:hidden">
          <van-list>
            <van-cell v-for="o in stats.recent_orders" :key="o.id" :title="o.customer_name" :label="o.order_date.substring(5,16)" is-link @click="showOrderDetailPage(o.id)" center>
              <template #icon><van-icon name="orders-o" size="22" color="#667eea" style="margin-right:12px" /></template>
              <template #value><div style="font-weight:600" :class="o.type==='OUT'?'text-red':'text-green'">{{o.type==='OUT'?'ğŸ“¤ é€è´§':'ğŸ“¥ æ”¶è´§'}}</div><div style="font-size:10px;color:#999">{{ o.order_no || '#'+o.id }}</div></template>
            </van-cell>
          </van-list>
        </div>
      </div>
      <div v-show="activeTab === 'order'">
        <div class="card">
          <van-field v-model="selectedCustomerName" is-link readonly label="é¡¹ç›®å®¢æˆ·" @click="showCustPicker=true" placeholder="ç‚¹å‡»é€‰æ‹©" size="large" input-align="right"></van-field>
          <van-field v-model="orderDeposit" type="number" label="æœ¬æ¬¡æŠ¼é‡‘" placeholder="0.00" size="large" input-align="right" autocomplete="off"></van-field>
          <van-field name="radio" label="ä¸šåŠ¡ç±»å‹">
            <template #input>
              <van-radio-group v-model="orderType" direction="horizontal" @change="cart=[]">
                <van-radio name="OUT">ğŸ“¤ é€è´§å‡ºåº“</van-radio>
                <van-radio name="IN">ğŸ“¥ æ”¶è´§å…¥åº“</van-radio>
              </van-radio-group>
            </template>
          </van-field>
          <van-field v-model="orderNote" label="å¤‡æ³¨ä¿¡æ¯" placeholder="å¦‚ï¼šå·¥åœ°åç§°ã€è½¦ç‰Œå·" size="large" input-align="right"></van-field>
        </div>
        <div v-if="cart.length">
          <div class="section-header">
            <div class="section-title">å·²é€‰ç‰©èµ„</div>
            <div style="color:#667eea;font-size:13px;">å…± {{ cart.length }} é¡¹</div>
          </div>
          <div class="card" style="margin-top:0">
            <div v-for="(item,idx) in cart" :key="idx" style="margin-bottom:14px;border-bottom:1px solid #f0f0f0;padding-bottom:12px">
              <div style="display:flex;justify-content:space-between;align-items:center">
                <div style="font-weight:600;font-size:16px">{{item.name}}</div>
                <van-icon name="delete-o" color="#ee0a24" size="20" @click="cart.splice(idx,1)"/>
              </div>
              <div style="margin-top:10px;display:flex;justify-content:space-between;align-items:center;font-size:14px;color:#666">
                <div>ç§Ÿé‡‘: <input v-model.number="item.daily_rent_price" class="rent-input">/å¤©</div>
                <van-stepper v-model="item.qty" min="1" integer :max="orderType==='OUT'?item.total_stock:999999" button-size="28"/>
              </div>
            </div>
            <van-button block type="primary" size="large" @click="submitOrder" :loading="loading" round>æäº¤å¹¶ç”Ÿæˆå•æ®</van-button>
          </div>
        </div>
        <div style="padding:20px" v-if="selectedCustomerId">
          <div style="display: flex; gap: 10px;">
            <van-button block type="primary" icon="plus" @click="showProdPicker=true" round dashed>å•ä¸ªæ·»åŠ </van-button>
            <van-button block type="primary" icon="more-o" @click="showBatchProdPicker=true" round dashed>æ‰¹é‡é€‰æ‹©</van-button>
          </div>
        </div>
      </div>
      <div v-show="activeTab === 'goods'">
        <van-sticky><van-search v-model="searchText" placeholder="æœç´¢ç‰©èµ„åç§°æˆ–è§„æ ¼" background="#f5f7fa" shape="round"></van-search></van-sticky>
        <div class="card" style="padding:0; margin-top:5px">
          <van-list>
            <van-cell v-for="p in filteredProducts" :key="p.id" :title="p.name" is-link @click="showDistribution(p)" center>
              <template #label>
                <span class="badge badge-primary">{{p.spec || 'æ ‡å‡†'}}</span>
                <span style="color:#ee0a24;font-weight:500;margin-left:8px">Â¥{{p.daily_rent_price}}/å¤©</span>
              </template>
              <template #value>
                <div style="color:#323233;font-weight:600">åº“: {{p.total_stock}} {{p.unit||'ä¸ª'}}</div>
                <div style="font-size:10px;color:#969799">åŸå€¼: Â¥{{p.unit_price}}</div>
              </template>
            </van-cell>
          </van-list>
        </div>
      </div>
      <div v-show="activeTab === 'customers'" class="card" style="padding:0">
          <van-list>
            <van-cell v-for="c in customers" :key="c.id" :title="c.name" :value="'Â¥ '+Math.abs(c.balance||0).toFixed(2)" :value-class="c.balance>=0?'text-green':'text-red'" is-link @click="openProjectPage(c)" center>
              <template #icon><van-icon name="manager-o" size="20" style="margin-right:10px;color:#667eea" /></template>
              <template #label>
                <span v-if="c.category_name" class="badge badge-primary">{{c.category_name}}</span>
                <span :class="'badge badge-' + getCreditLevelBadge(c.credit_level)" style="margin-left:8px">
                  {{ getCreditLevelText(c.credit_level) }}
                </span>
              </template>
            </van-cell>
          </van-list>
        </div>
      </van-pull-refresh>
        <van-tabbar v-model="activeTab" fixed placeholder @change="onTabChange">
          <van-tabbar-item name="home" icon="home-o">é¦–é¡µ</van-tabbar-item>
          <van-tabbar-item name="order" icon="edit">å¼€å•</van-tabbar-item>
          <van-tabbar-item name="goods" icon="apps-o">ç‰©èµ„</van-tabbar-item>
          <van-tabbar-item name="customers" icon="manager-o">å®¢æˆ·</van-tabbar-item>
        </van-tabbar>
      </div>
    <div v-if="currentView === 'admin_auth'" class="fullscreen-page" style="text-align:center;padding-top:80px;background:linear-gradient(135deg, #667eea 0%, #764ba2 100%)">
      <van-nav-bar title="ç®¡ç†å‘˜éªŒè¯" left-text="è¿”å›" left-arrow @click-left="goBack" fixed placeholder></van-nav-bar>
      <div style="padding:40px 30px">
        <div style="background:rgba(255,255,255,0.2);width:90px;height:90px;border-radius:50%;margin:0 auto 30px;display:flex;align-items:center;justify-content:center">
          <van-icon name="lock" size="48" color="#fff"></van-icon>
        </div>
        <h3 style="margin:20px 0;color:#fff;font-size:22px">ç³»ç»Ÿç®¡ç†åå°</h3>
        <van-field v-model="adminPwdInput" type="password" placeholder="è¯·è¾“å…¥ç®¡ç†å¯†ç " input-align="center" style="border:1px solid rgba(255,255,255,0.3); border-radius:12px; padding: 15px; background:rgba(255,255,255,0.9);" :autofocus="true" :error-message="authErrorMsg" @focus="authErrorMsg=''"></van-field>
        <div style="margin-top:30px">
          <van-button block type="primary" @click="doAdminAuth" :loading="authLoading" round size="large" style="background:#fff !important;color:#667eea !important;font-weight:600;">éªŒè¯å¹¶è¿›å…¥</van-button>
        </div>
        <div style="margin-top:20px;color:rgba(255,255,255,0.7);font-size:12px">
          é»˜è®¤å¯†ç ï¼šadmin
        </div>
      </div>
    </div>
    <div v-if="currentView === 'admin_panel'" class="fullscreen-page">
      <van-nav-bar title="ğŸ”§ ç³»ç»Ÿè®¾ç½®" left-text="é€€å‡º" left-arrow @click-left="goBack" fixed placeholder>
        <template #right>
          <div style="display: flex; align-items: center; gap: 12px;">
            <div style="position: relative; cursor: pointer;" @click="showGlobalSearch = true">
              <van-icon name="search" size="20" color="#667eea" />
            </div>
            <div style="position: relative; cursor: pointer;" @click="showNotificationPanel = true">
              <van-icon name="bell" size="20" color="#667eea" />
              <van-badge v-if="notificationCount > 0" :content="notificationCount" style="position: absolute; top: -8px; right: -8px;" />
            </div>
          </div>
        </template>
      </van-nav-bar>
      <div style="padding:16px">
        <!-- ç³»ç»Ÿæ¦‚è§ˆå¡ç‰‡ -->
        <div class="card" style="margin-bottom:20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 24px;">
          <div style="font-size: 18px; font-weight: 700; margin-bottom: 16px;">ç³»ç»Ÿæ¦‚è§ˆ</div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
            <div style="text-align: center; background: rgba(255,255,255,0.1); border-radius: 12px; padding: 16px;">
              <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">ğŸ“¦ ç‰©èµ„æ€»æ•°</div>
              <div style="font-size: 24px; font-weight: 700;">{{ products.length }} é¡¹</div>
            </div>
            <div style="text-align: center; background: rgba(255,255,255,0.1); border-radius: 12px; padding: 16px;">
              <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">ğŸ‘¥ å®¢æˆ·æ€»æ•°</div>
              <div style="font-size: 24px; font-weight: 700;">{{ customers.length }} ä½</div>
            </div>
            <div style="text-align: center; background: rgba(255,255,255,0.1); border-radius: 12px; padding: 16px;">
              <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">ğŸ“¤ åœ¨ç§Ÿç‰©èµ„</div>
              <div style="font-size: 24px; font-weight: 700;">{{ stats.total_out || 0 }}</div>
            </div>
            <div style="text-align: center; background: rgba(255,255,255,0.1); border-radius: 12px; padding: 16px;">
              <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">âš ï¸ åº“å­˜é¢„è­¦</div>
              <div style="font-size: 24px; font-weight: 700;" :class="stats.low_stock_count > 0 ? 'text-red' : ''">{{ stats.low_stock_count || 0 }}</div>
            </div>
          </div>
        </div>

        <!-- æ•°æ®ç»Ÿè®¡å¡ç‰‡ -->
        <div class="card" style="margin-bottom:20px;">
          <div style="font-size: 16px; font-weight: 700; margin-bottom: 16px; color: var(--text-primary);">ğŸ“Š æ•°æ®ç»Ÿè®¡</div>
          <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px;">
            <div style="text-align: center; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; color: white;">
              <div style="font-size: 12px; opacity: 0.9; margin-bottom: 6px;">ğŸ’° ä»Šæ—¥æ”¶å…¥</div>
              <div style="font-size: 18px; font-weight: 700;">Â¥{{ (stats.today_income || 0).toFixed(0) }}</div>
            </div>
            <div style="text-align: center; padding: 12px; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); border-radius: 12px; color: white;">
              <div style="font-size: 12px; opacity: 0.9; margin-bottom: 6px;">ğŸ“ˆ ä»Šæ—¥è®¢å•</div>
              <div style="font-size: 18px; font-weight: 700;">{{ stats.today_orders || 0 }} å•</div>
            </div>
            <div style="text-align: center; padding: 12px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 12px; color: white;">
              <div style="font-size: 12px; opacity: 0.9; margin-bottom: 6px;">ğŸ’³ å®¢æˆ·æ¬ æ¬¾</div>
              <div style="font-size: 18px; font-weight: 700;">Â¥{{ (stats.total_debt || 0).toFixed(0) }}</div>
            </div>
          </div>
        </div>

        <!-- å¿«æ·æ“ä½œ -->
        <div class="section-header" style="padding-left:0;padding-right:0; margin-bottom:12px;">
          <div class="section-title">å¿«æ·æ“ä½œ</div>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 20px;">
          <div class="admin-card" @click="goToPage('order')" style="margin: 0; flex-direction: column; align-items: center; justify-content: center; padding: 20px 10px;">
            <van-icon name="add-o" size="28" color="#667eea" />
            <div style="font-weight:600; font-size:13px; margin-top:8px">åˆ›å»ºè®¢å•</div>
          </div>
          <div class="admin-card" @click="enterGoodsMgr" style="margin: 0; flex-direction: column; align-items: center; justify-content: center; padding: 20px 10px;">
            <van-icon name="plus" size="28" color="#11998e" />
            <div style="font-weight:600; font-size:13px; margin-top:8px">æ–°å¢ç‰©èµ„</div>
          </div>
          <div class="admin-card" @click="enterCustMgr" style="margin: 0; flex-direction: column; align-items: center; justify-content: center; padding: 20px 10px;">
            <van-icon name="user-add-o" size="28" color="#f093fb" />
            <div style="font-weight:600; font-size:13px; margin-top:8px">æ–°å¢å®¢æˆ·</div>
          </div>
        </div>

        <!-- åŸºç¡€èµ„æ–™ç®¡ç† -->
        <div class="section-header" style="padding-left:0;padding-right:0; margin-bottom:12px;">
          <div class="section-title">åŸºç¡€èµ„æ–™ç®¡ç†</div>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px;">
          <div class="admin-card" @click="enterGoodsMgr" style="margin: 0;">
            <div style="display:flex; align-items:center">
              <div class="admin-icon-box" style="background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); color:#fff"><van-icon name="points" /></div>
              <div>
                <div style="font-weight:600; font-size:16px; margin-bottom:4px">ğŸ“¦ ç‰©èµ„ç®¡ç†</div>
                <div style="color:#969799; font-size:12px">æ–°å¢ç‰©èµ„ã€åº“å­˜/ç§Ÿé‡‘/åŸå€¼</div>
              </div>
            </div>
            <van-icon name="arrow" color="#ccc" />
          </div>
          <div class="admin-card" @click="enterCustMgr" style="margin: 0;">
            <div style="display:flex; align-items:center">
              <div class="admin-icon-box" style="background:linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color:#fff"><van-icon name="friends-o" /></div>
              <div>
                <div style="font-weight:600; font-size:16px; margin-bottom:4px">ğŸ‘¥ å®¢æˆ·ç®¡ç†</div>
                <div style="color:#969799; font-size:12px">æ–°å¢å®¢æˆ·ã€æ¡£æ¡ˆä¿¡æ¯ç»´æŠ¤</div>
              </div>
            </div>
            <van-icon name="arrow" color="#ccc" />
          </div>
        </div>

        <!-- ç³»ç»Ÿé…ç½® -->
        <div class="section-header" style="padding-left:0;padding-right:0; margin-bottom:12px;">
          <div class="section-title">ç³»ç»Ÿé…ç½®</div>
        </div>
        <div class="card" style="margin-bottom:20px;">
          <van-field v-model="configForm.sys_name" label="ç³»ç»Ÿåç§°" @blur="autoPrefix" input-align="right" placeholder="è¯·è¾“å…¥ç³»ç»Ÿåç§°" />
          <van-field v-model="configForm.order_prefix" label="å•å·å‰ç¼€" input-align="right" placeholder="è¯·è¾“å…¥å•å·å‰ç¼€" />
          <van-field v-model="configForm.factory_name" label="æ‰“å°æŠ¬å¤´" input-align="right" placeholder="è¯·è¾“å…¥æ‰“å°æŠ¬å¤´" />
          <van-field v-model="configForm.contact_info" label="å‘è´§åœ°å€" type="textarea" rows="2" input-align="right" placeholder="è¯·è¾“å…¥å‘è´§åœ°å€" />
        </div>

        <!-- è´¦å·å®‰å…¨ -->
        <div class="section-header" style="padding-left:0;padding-right:0; margin-bottom:12px;">
          <div class="section-title">è´¦å·å®‰å…¨</div>
        </div>
        <div class="card" style="margin-bottom:20px;">
          <van-field v-model="configForm.old_pwd" type="password" label="å½“å‰å¯†ç " placeholder="è¯·è¾“å…¥å½“å‰å¯†ç " input-align="right" />
          <van-field v-model="configForm.new_pwd" type="password" label="æ–°å¯†ç " placeholder="ä¸æ”¹è¯·ç•™ç©º" input-align="right" />
          <van-field v-model="configForm.confirm_pwd" type="password" label="ç¡®è®¤å¯†ç " placeholder="è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç " input-align="right" />
        </div>

        <!-- æ•°æ®ç®¡ç† -->
        <div class="section-header" style="padding-left:0;padding-right:0; margin-bottom:12px;">
          <div class="section-title">æ•°æ®ç®¡ç†</div>
        </div>
        <div class="card" style="margin-bottom:20px;">
          <div style="display: flex; flex-direction: column; gap: 10px;">
            <div style="font-weight: 600; margin-bottom: 10px;">ğŸ“¤ å¯¼å‡ºæ•°æ®</div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
              <van-button type="primary" plain @click="exportData('products')" round :loading="exportLoading">å¯¼å‡ºç‰©èµ„æ•°æ®</van-button>
              <van-button type="primary" plain @click="exportData('customers')" round :loading="exportLoading">å¯¼å‡ºå®¢æˆ·æ•°æ®</van-button>
              <van-button type="primary" plain @click="exportData('orders')" round :loading="exportLoading" style="grid-column: 1 / -1;">å¯¼å‡ºè®¢å•æ•°æ®</van-button>
            </div>
            <div style="font-weight: 600; margin: 20px 0 10px;">ğŸ“¥ å¯¼å…¥æ•°æ®</div>
            <input type="file" id="fileInput" style="display: none" @change="importData" accept=".json" />
            <van-button type="primary" plain @click="document.getElementById('fileInput').click()" round :loading="importLoading">é€‰æ‹©JSONæ–‡ä»¶å¯¼å…¥</van-button>
          </div>
        </div>

        <!-- æ•°æ®å¤‡ä»½ -->
        <div class="section-header" style="padding-left:0;padding-right:0; margin-bottom:12px;">
          <div class="section-title">æ•°æ®å¤‡ä»½</div>
        </div>
        <div class="card" style="margin-bottom:20px;">
          <div style="display: flex; flex-direction: column; gap: 10px;">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
              <van-button type="success" plain @click="createBackup" round :loading="backupLoading">åˆ›å»ºå¤‡ä»½</van-button>
              <van-button type="warning" plain @click="showRestoreDialog = true" round>æ¢å¤å¤‡ä»½</van-button>
            </div>
            <div style="font-weight: 600; margin: 20px 0 10px;">è‡ªåŠ¨å¤‡ä»½è®¾ç½®</div>
            <van-cell-group inset>
              <van-cell title="å¯ç”¨è‡ªåŠ¨å¤‡ä»½" center>
                <template #right-icon>
                  <van-switch v-model="autoBackupEnabled" size="20" />
                </template>
              </van-cell>
              <van-field v-model="backupInterval" type="number" label="å¤‡ä»½é—´éš”(å¤©)" placeholder="7" input-align="right" />
              <van-cell title="ä¸Šæ¬¡å¤‡ä»½æ—¶é—´" :value="lastBackupTime || 'ä»æœªå¤‡ä»½'" />
            </van-cell-group>
            <div style="font-weight: 600; margin: 20px 0 10px;">å¤‡ä»½å†å²</div>
            <div v-if="backupHistory.length" style="max-height: 200px; overflow-y: auto;">
              <van-cell v-for="(backup, index) in backupHistory" :key="index" :title="backup.name" :label="backup.date" is-link @click="restoreBackup(index)">
                <template #right-icon>
                  <van-icon name="replay" color="#1989fa" />
                </template>
              </van-cell>
            </div>
            <van-empty v-else description="æš‚æ— å¤‡ä»½è®°å½•" />
          </div>
        </div>

        <!-- æ•°æ®æŠ¥è¡¨ -->
        <div class="section-header" style="padding-left:0;padding-right:0; margin-bottom:12px;">
          <div class="section-title">æ•°æ®æŠ¥è¡¨</div>
        </div>
        <div class="admin-card" @click="goToPage('stats_page')" style="margin-bottom:12px;">
          <div style="display:flex; align-items:center">
            <div class="admin-icon-box" style="background:linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color:#fff"><van-icon name="bar-chart" /></div>
            <div>
              <div style="font-weight:600; font-size:16px; margin-bottom:4px">ğŸ“Š æ•°æ®ç»Ÿè®¡</div>
              <div style="color:#969799; font-size:12px">ä¸šåŠ¡åˆ†æã€è¶‹åŠ¿å›¾è¡¨</div>
            </div>
          </div>
          <van-icon name="arrow" color="#ccc" />
        </div>
        <div class="admin-card" @click="showOperationLogs = true" style="margin-bottom:30px;">
          <div style="display:flex; align-items:center">
            <div class="admin-icon-box" style="background:linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color:#fff"><van-icon name="records" /></div>
            <div>
              <div style="font-weight:600; font-size:16px; margin-bottom:4px">ğŸ“ æ“ä½œæ—¥å¿—</div>
              <div style="color:#969799; font-size:12px">æŸ¥çœ‹ç³»ç»Ÿæ“ä½œè®°å½•</div>
            </div>
          </div>
          <van-icon name="arrow" color="#ccc" />
        </div>

        <!-- ä¿å­˜æŒ‰é’® -->
        <van-button block type="primary" @click="saveConfig" :loading="configLoading" round style="font-size:16px; padding:16px;">ğŸ’¾ ä¿å­˜æ‰€æœ‰é…ç½®</van-button>
      </div>
    </div>
    <div v-if="currentView === 'admin_goods_mgr'" class="fullscreen-page">
      <van-nav-bar title="ğŸ“¦ ç‰©èµ„åº“ç®¡ç†" left-text="è¿”å›" left-arrow @click-left="goToPage('admin_panel')" fixed placeholder>
        <template #right>
          <div style="display: flex; align-items: center; gap: 12px;">
            <div class="icon-btn" @click="openCategoryMgr">
              <van-icon name="apps-o" color="#667eea" size="20" />
            </div>
            <div class="icon-btn" @click="showBatchEditDialog = true" v-if="selectedProducts.length">
              <van-icon name="edit" color="#667eea" size="20" />
            </div>
            <div class="icon-btn" @click="showBatchDeleteDialog = true" v-if="selectedProducts.length">
              <van-icon name="delete" color="#ee0a24" size="20" />
            </div>
            <div class="icon-btn" @click="openGoodsEditorPage(null)">
              <van-icon name="plus" color="#667eea" size="20" />
            </div>
          </div>
        </template>
      </van-nav-bar>
      <van-search v-model="searchText" placeholder="æœç´¢ç‰©èµ„åç§°ã€è§„æ ¼æˆ–åˆ†ç±»..." background="#fff" shape="round"></van-search>
      <div style="padding:10px">
        <van-list>
          <van-cell v-for="p in filteredProducts" :key="p.id" :title="p.name" :value="'åº“:'+p.total_stock" center style="border-radius:12px;margin-bottom:6px" @click="toggleProductSelection(p.id)">
            <template #left>
              <van-checkbox v-model="selectedProducts" :name="p.id" style="margin-right: 10px;" />
            </template>
            <template #label>{{p.spec}} | ç§Ÿ:{{p.daily_rent_price}} | åŸ:{{p.unit_price}} | {{p.category_name || 'æœªåˆ†ç±»'}}</template>
            <template #right-icon>
              <div style="display: flex; align-items: center; gap: 8px;">
                <van-icon name="edit" color="#667eea" size="20" @click.stop="openGoodsEditorPage(p)"/>
                <van-icon name="warning-o" color="#ff976a" size="20" @click.stop="openRepairRecord(p)"/>
              </div>
            </template>
          </van-cell>
        </van-list>
        <van-empty v-if="!filteredProducts.length" description="æš‚æ— ç‰©èµ„ï¼Œè¯·ç‚¹å‡»å³ä¸Šè§’+æ–°å¢" />
      </div>
      <van-dialog v-model:show="showBatchDeleteDialog" title="æ‰¹é‡åˆ é™¤" show-cancel-button @confirm="batchDeleteProducts">
        <div>ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ {{selectedProducts.length}} ä¸ªç‰©èµ„å—ï¼Ÿ</div>
      </van-dialog>
      <van-popup v-model:show="showBatchEditDialog" position="bottom" round style="height:80%">
        <div style="padding: 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">
          <h3 style="margin: 0;">æ‰¹é‡æ“ä½œ</h3>
          <van-button type="primary" size="small" @click="batchUpdateProducts">æ‰§è¡Œæ“ä½œ</van-button>
        </div>
        <div style="padding: 15px;">
          <div class="card-group-title">æ‰¹é‡ä¿®æ”¹</div>
          <van-cell-group inset>
            <van-field v-model="batchForm.category_id" is-link readonly label="ç‰©èµ„åˆ†ç±»" @click="showBatchCategoryPicker=true" placeholder="ç»Ÿä¸€ä¿®æ”¹åˆ†ç±»" input-align="right"/>
            <van-field v-model="batchForm.daily_rent_price" type="number" label="æ—¥ç§Ÿèµè´¹" placeholder="ç»Ÿä¸€ä¿®æ”¹ç§Ÿé‡‘" input-align="right"><template #right-icon>å…ƒ</template></van-field>
            <van-field v-model="batchForm.unit_price" type="number" label="ç‰©èµ„åŸå€¼" placeholder="ç»Ÿä¸€ä¿®æ”¹åŸå€¼" input-align="right"><template #right-icon>å…ƒ</template></van-field>
            <van-field v-model="batchForm.unit" label="è®¡é‡å•ä½" placeholder="ç»Ÿä¸€ä¿®æ”¹å•ä½" input-align="right"/>
          </van-cell-group>
          
          <div class="card-group-title" style="margin-top: 20px;">åº“å­˜è°ƒæ•´</div>
          <van-cell-group inset>
            <van-field v-model="batchForm.stock_change" type="number" label="åº“å­˜è°ƒæ•´" placeholder="æ­£æ•°å¢åŠ ï¼Œè´Ÿæ•°å‡å°‘" input-align="right"><template #right-icon>{{batchForm.unit || 'ä¸ª'}}</template></van-field>
          </van-cell-group>
          
          <div style="margin-top: 20px; padding: 15px; background: #f0f9ff; border-radius: 8px;">
            <div style="font-weight: bold; margin-bottom: 10px;">æ“ä½œè¯´æ˜</div>
            <div style="font-size: 12px; color: #666; line-height: 1.5;">
              â€¢ å¡«å†™çš„å­—æ®µä¼šç»Ÿä¸€ä¿®æ”¹é€‰ä¸­ç‰©èµ„<br>
              â€¢ åº“å­˜è°ƒæ•´ä¼šç›´æ¥å¢åŠ æˆ–å‡å°‘åº“å­˜<br>
              â€¢ ç•™ç©ºçš„å­—æ®µä¸ä¼šä¿®æ”¹
            </div>
          </div>
        </div>
      </van-popup>
      <van-popup v-model:show="showBatchCategoryPicker" position="bottom" round>
        <div style="padding: 15px; border-bottom: 1px solid #eee;">
          <h3 style="margin: 0;">é€‰æ‹©åˆ†ç±»</h3>
        </div>
        <van-picker :columns="categoryColumns" @confirm="onPickBatchCategory" @cancel="showBatchCategoryPicker=false" />
      </van-popup>
    </div>
    <div v-if="currentView === 'stats_page'" class="fullscreen-page">
      <van-nav-bar title="ğŸ“Š æ•°æ®ç»Ÿè®¡" left-text="è¿”å›" left-arrow @click-left="goToPage('admin_panel')" fixed placeholder>
        <template #right>
          <div class="icon-btn" @click="exportPDF" title="å¯¼å‡ºPDF">
            <van-icon name="down" size="20" color="#1989fa" />
          </div>
        </template>
      </van-nav-bar>
      <div style="padding:12px">
        <van-tabs v-model:active="statsActiveTab" sticky>
          <van-tab title="ä¸šåŠ¡æ¦‚è§ˆ">
            <div class="stat-grid">
              <div class="stat-card purple"><div class="stat-label">ğŸ’° æ—¥ç§Ÿé‡‘é¢„è®¡</div><div class="stat-val">Â¥ {{ (stats.daily_income || 0).toFixed(2) }}</div></div>
              <div class="stat-card orange"><div class="stat-label">ğŸ“¦ åœ¨å¤–ç‰©èµ„æ€»æ•°</div><div class="stat-val">{{ stats.total_out || 0 }}</div></div>
              <div class="stat-card green"><div class="stat-label">ğŸ“¦ ç‰©èµ„æ€»æ•°</div><div class="stat-val">{{ products.length }}</div></div>
              <div class="stat-card blue"><div class="stat-label">ğŸ‘¥ å®¢æˆ·æ€»æ•°</div><div class="stat-val">{{ customers.length }}</div></div>
            </div>
            <div class="section-header">
              <div class="section-title">æœ€è¿‘7å¤©è®¢å•è¶‹åŠ¿</div>
            </div>
            <div class="card" style="margin-top:0"><div id="chart-order-trend" style="width:100%;height:220px;"></div></div>
            <div class="section-header">
              <div class="section-title">æ”¶å…¥è¶‹åŠ¿</div>
            </div>
            <div class="card" style="margin-top:0"><div id="chart-income-trend" style="width:100%;height:220px;"></div></div>
          </van-tab>
          <van-tab title="ç‰©èµ„åˆ†æ">
            <div class="section-header">
              <div class="section-title">ç‰©èµ„åˆ†ç±»åˆ†å¸ƒ</div>
            </div>
            <div class="card" style="margin-top:0"><div id="chart-category" style="width:100%;height:220px;"></div></div>
            <div class="section-header">
              <div class="section-title">åº“å­˜çŠ¶æ€</div>
            </div>
            <div class="card" style="margin-top:0">
              <van-cell v-for="item in categoryStats" :key="item.category" :title="item.category || 'æœªåˆ†ç±»'" :value="item.total_stock + ' ' + (item.total_stock === 1 ? 'ä¸ª' : 'ä¸ª')" />
            </div>
            <div class="section-header">
              <div class="section-title">ç‰©èµ„å‘¨è½¬ç‡</div>
            </div>
            <div class="card" style="margin-top:0"><div id="chart-turnover" style="width:100%;height:220px;"></div></div>
          </van-tab>
          <van-tab title="å®¢æˆ·åˆ†æ">
            <div class="section-header">
              <div class="section-title">å®¢æˆ·åˆ†ç±»åˆ†å¸ƒ</div>
            </div>
            <div class="card" style="margin-top:0"><div id="chart-customer-category" style="width:100%;height:220px;"></div></div>
            <div class="section-header">
              <div class="section-title">ä¿¡ç”¨ç­‰çº§åˆ†å¸ƒ</div>
            </div>
            <div class="card" style="margin-top:0"><div id="chart-credit" style="width:100%;height:220px;"></div></div>
            <div class="section-header">
              <div class="section-title">å®¢æˆ·æ¶ˆè´¹æ’è¡Œ</div>
            </div>
            <div class="card" style="margin-top:0">
              <van-cell v-for="(item, index) in topCustomers" :key="item.id" :title="(index + 1) + '. ' + item.name" :value="'Â¥' + Math.abs(item.balance || 0).toFixed(2)" :value-class="item.balance >= 0 ? 'text-green' : 'text-red'" />
            </div>
          </van-tab>
          <van-tab title="è‡ªå®šä¹‰æŠ¥è¡¨">
            <div class="card">
              <van-field label="æŠ¥è¡¨ç±»å‹" is-link readonly :value="reportTypeText" @click="showReportTypePicker = true" />
              <van-field label="æ—¶é—´èŒƒå›´" is-link readonly :value="dateRangeText" @click="showDatePicker = true" />
              <van-field label="æ•°æ®ç±»å‹" is-link readonly :value="dataTypeText" @click="showDataTypePicker = true" />
            </div>
            <div style="margin-top:20px">
              <van-button block type="primary" @click="generateCustomReport" :loading="reportLoading" round>ç”ŸæˆæŠ¥è¡¨</van-button>
            </div>
            <div v-if="customReportData" class="card" style="margin-top:20px">
              <div class="section-header">
                <div class="section-title">æŠ¥è¡¨ç»“æœ</div>
              </div>
              <div id="custom-report-chart" style="width:100%;height:300px;"></div>
              <div style="margin-top:20px">
                <van-button block type="primary" plain @click="exportCustomReport" round>å¯¼å‡ºæŠ¥è¡¨</van-button>
              </div>
            </div>
          </van-tab>
        </van-tabs>
      </div>
    </div>
    <div v-if="currentView === 'repair_record'" class="fullscreen-page">
      <van-nav-bar title="ğŸ› ï¸ ç»´ä¿®è®°å½•" left-text="è¿”å›" left-arrow @click-left="goBack" fixed placeholder>
        <template #right>
          <div class="icon-btn" @click="openRepairEditor(null)">
            <van-icon name="plus" size="20" color="#1989fa" />
          </div>
        </template>
      </van-nav-bar>
      <div style="padding:10px">
        <van-list>
          <van-cell v-for="r in repairRecords" :key="r.id" :title="r.product_name" :label="r.repair_date + ' | ' + r.status" center style="border-radius:8px;margin-bottom:8px">
            <template #right-icon>
              <van-icon name="edit" color="#1989fa" size="22" @click.stop="openRepairEditor(r)" style="padding-left:10px;"/>
            </template>
          </van-cell>
        </van-list>
        <van-empty v-if="!repairRecords.length" description="æš‚æ— ç»´ä¿®è®°å½•" />
      </div>
    </div>
    <div v-if="currentView === 'repair_edit'" class="fullscreen-page">
      <van-nav-bar :title="repairForm.id?'ç¼–è¾‘ç»´ä¿®è®°å½•':'æ–°å¢ç»´ä¿®è®°å½•'" left-text="å–æ¶ˆ" left-arrow @click-left="goToPage('repair_record')" fixed placeholder></van-nav-bar>
      <div style="padding:15px">
        <van-cell-group inset>
          <van-field v-model="repairForm.product_name" is-link readonly label="ç‰©èµ„åç§°" @click="showProductPicker=true" placeholder="ç‚¹å‡»é€‰æ‹©" size="large" input-align="right"/>
          <van-field v-model="repairForm.description" label="æŸåæè¿°" type="textarea" rows="3" placeholder="è¯·æè¿°æŸåæƒ…å†µ" size="large" input-align="right"/>
          <van-field v-model="repairForm.cost" type="number" label="ç»´ä¿®è´¹ç”¨" placeholder="0.00" size="large" input-align="right"><template #right-icon>å…ƒ</template></van-field>
          <van-field v-model="repairForm.status" label="ç»´ä¿®çŠ¶æ€">
            <template #input>
              <van-radio-group v-model="repairForm.status" direction="horizontal">
                <van-radio name="PENDING">å¾…ç»´ä¿®</van-radio>
                <van-radio name="IN_PROGRESS">ç»´ä¿®ä¸­</van-radio>
                <van-radio name="COMPLETED">å·²å®Œæˆ</van-radio>
              </van-radio-group>
            </template>
          </van-field>
        </van-cell-group>
        <div style="margin-top:30px;padding:0 15px">
          <van-button block type="primary" size="large" @click="saveRepair" round>ğŸ’¾ ä¿å­˜è®°å½•</van-button>
        </div>
      </div>
    </div>
    <div v-if="currentView === 'admin_cust_mgr'" class="fullscreen-page">
      <van-nav-bar title="ğŸ‘¥ å®¢æˆ·æ¡£æ¡ˆç®¡ç†" left-text="è¿”å›" left-arrow @click-left="goToPage('admin_panel')" fixed placeholder>
        <template #right>
          <div style="display: flex; align-items: center; gap: 12px;">
            <div class="icon-btn" @click="showCustBatchDeleteDialog = true" v-if="selectedCustomers.length">
              <van-icon name="delete" color="#ee0a24" size="20" />
            </div>
            <div class="icon-btn" @click="openCustEditorPage(null)">
              <van-icon name="plus" size="20" color="#1989fa" />
            </div>
          </div>
        </template>
      </van-nav-bar>
      <van-search v-model="custSearchText" placeholder="æœç´¢å®¢æˆ·åç§°ã€ç”µè¯æˆ–é¡¹ç›®..." background="#fff"></van-search>
      <div style="padding:10px">
        <van-list>
          <van-cell v-for="c in filteredCustomers" :key="c.id" :title="c.name" :label="(c.contact||'æ— ç”µè¯') + ' | ' + (c.project_name||'æ— é¡¹ç›®')" center style="border-radius:8px;margin-bottom:8px" @click="toggleCustomerSelection(c.id)">
            <template #left>
              <van-checkbox v-model="selectedCustomers" :name="c.id" style="margin-right: 10px;" />
            </template>
            <template #right-icon>
              <div style="display: flex; align-items: center;">
                <van-icon name="edit" color="#1989fa" size="22" @click.stop="openCustEditorPage(c)" style="padding-left:10px;"/>
              </div>
            </template>
          </van-cell>
        </van-list>
        <van-empty v-if="!filteredCustomers.length" description="æš‚æ— å®¢æˆ·ï¼Œè¯·ç‚¹å‡»å³ä¸Šè§’+æ–°å¢" />
      </div>
      <van-dialog v-model:show="showCustBatchDeleteDialog" title="æ‰¹é‡åˆ é™¤" show-cancel-button @confirm="batchDeleteCustomers">
        <div>ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ {{selectedCustomers.length}} ä¸ªå®¢æˆ·å—ï¼Ÿ</div>
      </van-dialog>
    </div>
    <div v-if="currentView === 'goods_edit'" class="fullscreen-page">
      <van-nav-bar :title="prodForm.id?'ç¼–è¾‘ç‰©èµ„':'æ–°å¢ç‰©èµ„'" left-text="å–æ¶ˆ" left-arrow @click-left="goToPage('admin_goods_mgr')" fixed placeholder></van-nav-bar>
      <div style="padding:12px">
        <div class="section-header" style="padding-left:0;padding-right:0;">
          <div class="section-title">åŸºæœ¬ä¿¡æ¯</div>
        </div>
        <div class="card">
          <van-field v-model="prodForm.name" label="ç‰©èµ„åç§°" placeholder="å¿…å¡«" required size="large" input-align="right"/>
          <van-field v-model="prodForm.spec" label="è§„æ ¼å‹å·" placeholder="é€‰å¡«" size="large" input-align="right"/>
          <van-field v-model="prodForm.category_name" is-link readonly label="ç‰©èµ„åˆ†ç±»" @click="showCategoryPicker=true" placeholder="ç‚¹å‡»é€‰æ‹©" size="large" input-align="right"/>
          <van-field v-model="prodForm.unit" label="è®¡é‡å•ä½" placeholder="å¦‚: ä¸ªã€å¨" size="large" input-align="right"/>
          <van-field v-model="prodForm.weight" type="number" label="å•é‡" placeholder="å¯é€‰" size="large" input-align="right"/>
        </div>
        <div class="section-header" style="padding-left:0;padding-right:0;">
          <div class="section-title">åº“å­˜ä¸ä»·æ ¼</div>
        </div>
        <div class="card">
          <van-field v-model="prodForm.total_stock" type="number" label="åº“æˆ¿åº“å­˜" placeholder="0" size="large" input-align="right"/>
          <van-field v-model="prodForm.min_stock" type="number" label="åº“å­˜é¢„è­¦" placeholder="0" size="large" input-align="right"/>
          <van-field v-model="prodForm.daily_rent_price" type="number" label="æ—¥ç§Ÿèµè´¹" placeholder="0.00" size="large" input-align="right"><template #right-icon>å…ƒ</template></van-field>
          <van-field v-model="prodForm.unit_price" type="number" label="ç‰©èµ„åŸå€¼" placeholder="ä¸¢å¤±èµ”å¿ä»·" size="large" label-class="text-red" input-align="right"><template #right-icon>å…ƒ</template></van-field>
          <van-field v-model="prodForm.deposit_price" type="number" label="å•å“æŠ¼é‡‘" placeholder="å¯é€‰" size="large" input-align="right"><template #right-icon>å…ƒ</template></van-field>
        </div>
        <div style="margin-top:30px;padding:0 15px">
          <van-button block type="primary" size="large" @click="saveProd" round>ğŸ’¾ ä¿å­˜ä¿¡æ¯</van-button>
          <van-button v-if="prodForm.id" block type="danger" plain style="margin-top:15px" @click="deleteProd" round>åˆ é™¤æ­¤ç‰©èµ„</van-button>
        </div>
      </div>
    </div>
    <div v-if="currentView === 'cust_edit'" class="fullscreen-page">
      <van-nav-bar :title="custForm.id?'ç¼–è¾‘å®¢æˆ·':'æ–°å¢å®¢æˆ·'" left-text="å–æ¶ˆ" left-arrow @click-left="goToPage('admin_cust_mgr')" fixed placeholder></van-nav-bar>
      <div style="padding:12px">
        <div class="section-header" style="padding-left:0;padding-right:0;">
          <div class="section-title">å®¢æˆ·æ¡£æ¡ˆ</div>
        </div>
        <div class="card">
          <van-field v-model="custForm.name" label="å®¢æˆ·å§“å" placeholder="å¿…å¡«" required size="large" input-align="right"/>
          <van-field v-model="custForm.project_name" label="é¡¹ç›®åç§°" placeholder="å·¥åœ°åç§°" size="large" input-align="right"/>
          <van-field v-model="custForm.contact" label="è”ç³»ç”µè¯" placeholder="æ‰‹æœºå·" size="large" input-align="right"/>
          <van-field v-model="custForm.id_card" label="èº«ä»½è¯å·" placeholder="é€‰å¡«ï¼Œå®åç™»è®°" size="large" input-align="right"/>
          <van-field v-model="custForm.address" label="é€è´§åœ°å€" type="textarea" rows="2" autosize size="large" placeholder="å·¥åœ°è¯¦ç»†åœ°å€" input-align="right"/>
          <van-field v-model="custForm.category_name" is-link readonly label="å®¢æˆ·åˆ†ç±»" @click="showCustCategoryPicker=true" placeholder="ç‚¹å‡»é€‰æ‹©" size="large" input-align="right"/>
          <van-field v-model="custForm.credit_level_text" is-link readonly label="ä¿¡ç”¨ç­‰çº§" @click="showCreditLevelPicker=true" placeholder="ç‚¹å‡»é€‰æ‹©" size="large" input-align="right"/>
          <van-field v-model="custForm.notes" label="å¤‡æ³¨ä¿¡æ¯" placeholder="ä¿¡ç”¨è®°å½•ç­‰" size="large" input-align="right"/>
        </div>
        <div style="margin-top:30px;padding:0 15px">
          <van-button block type="primary" size="large" @click="saveCustomer" round>ğŸ’¾ ä¿å­˜å®¢æˆ·</van-button>
        </div>
      </div>
    </div>
    <van-popup v-model:show="showCustCategoryPicker" position="bottom" round>
      <div style="padding: 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">
        <h3 style="margin: 0;">é€‰æ‹©å®¢æˆ·åˆ†ç±»</h3>
        <van-button type="primary" size="small" @click="openCustCategoryMgr">æ–°å¢åˆ†ç±»</van-button>
      </div>
      <van-picker :columns="custCategoryColumns" @confirm="onPickCustCategory" @cancel="showCustCategoryPicker=false" />
    </van-popup>
    <van-popup v-model:show="showCreditLevelPicker" position="bottom" round>
      <div style="padding: 15px; border-bottom: 1px solid #eee;">
        <h3 style="margin: 0;">é€‰æ‹©ä¿¡ç”¨ç­‰çº§</h3>
      </div>
      <van-picker :columns="creditLevelColumns" @confirm="onPickCreditLevel" @cancel="showCreditLevelPicker=false" />
    </van-popup>
    <van-popup v-model:show="showCustCategoryMgr" position="bottom" round closeable style="height:60%">
      <div style="padding:20px">
        <h3>å®¢æˆ·åˆ†ç±»ç®¡ç†</h3>
        <van-cell-group inset>
          <van-field v-model="custCategoryForm.name" label="åˆ†ç±»åç§°" placeholder="è¯·è¾“å…¥åˆ†ç±»åç§°"/>
          <van-field v-model="custCategoryForm.description" label="åˆ†ç±»æè¿°" placeholder="è¯·è¾“å…¥åˆ†ç±»æè¿°" type="textarea" rows="2"/>
        </van-cell-group>
        <div style="margin-top:30px">
          <van-button block type="primary" @click="saveCustCategory" round>ä¿å­˜åˆ†ç±»</van-button>
        </div>
        <div style="margin-top:10px">
          <van-list>
            <van-cell v-for="c in customerCategories" :key="c.id" :title="c.name" :label="c.description"/>
          </van-list>
        </div>
      </div>
    </van-popup>
    <div v-if="currentView === 'project_detail'" class="fullscreen-page">
      <van-nav-bar :title="proData.cust?.name" left-text="è¿”å›" left-arrow @click-left="goBack" fixed placeholder></van-nav-bar>
      <div style="padding:12px;background:white;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center">
        <div style="color:#646566;font-size:13px">
          <div>ğŸ“ ç”µè¯ï¼š{{proData.cust?.contact||'--'}}</div>
          <div>ğŸ—ï¸ é¡¹ç›®ï¼š{{proData.cust?.project_name||'--'}}</div>
          <div>ğŸ“ åœ°å€ï¼š{{proData.cust?.address||'--'}}</div>
        </div>
        <div style="text-align:right">
          <div style="font-size:12px;color:#969799">å½“å‰ä½™é¢</div>
          <div style="font-size:22px;font-weight:700" :class="proData.cust?.balance>=0?'text-green':'text-red'">Â¥ {{ (proData.cust?.balance||0).toFixed(2) }}</div>
        </div>
      </div>
      <van-tabs v-model:active="proTabActive" sticky>
        <van-tab title="ğŸ“¦ åœ¨ç§Ÿ">
          <div class="card" v-if="proData.stocks?.length">
            <div style="background:linear-gradient(135deg, #fff5f5 0%, #ffe8e8 100%);padding:12px;border-radius:12px;margin-bottom:12px;text-align:center">
              <div style="font-size:12px;color:#646566">ç‰©èµ„æ€»åŸå€¼ (ä¸¢å¤±èµ”å¿å‚è€ƒ)</div>
              <div style="font-size:22px;color:#ee0a24;font-weight:700">Â¥ {{ (proData.stocks.reduce((sum,s)=>sum+(s.quantity*(s.unit_price||0)),0)).toFixed(2) }}</div>
            </div>
            <van-cell v-for="s in proData.stocks" :key="s.name" :title="s.name" :value="s.quantity + (s.unit||'ä¸ª')" :label="'è§„æ ¼:'+s.spec+' | åŸå€¼:'+s.unit_price"/>
          </div>
          <van-empty v-else description="æ— åœ¨ç§Ÿç‰©èµ„" />
        </van-tab>
        <van-tab title="ğŸ’° è´¦ç›®">
          <div class="card">
            <div style="display:flex;gap:10px;margin-bottom:15px">
              <van-button block type="success" plain @click="exportExcel">å¯¼å‡ºæŠ¥è¡¨</van-button>
              <van-button block type="primary" @click="showPayDialog=true">ç™»è®°æ”¶æ¬¾</van-button>
            </div>
            <van-cell v-for="p in proData.payments" :key="p.id" :title="p.note" :label="p.pay_date" :value="'Â¥'+p.amount" :value-class="p.amount>0?'text-green':'text-red'"/>
          </div>
        </van-tab>
        <van-tab title="ğŸ“„ å•æ®">
          <div class="card">
            <van-cell v-for="o in proData.orders" :key="o.id" :title="o.order_no" :label="o.order_date" is-link @click="showOrderDetailPage(o.id)"/>
          </div>
        </van-tab>
      </van-tabs>
    </div>
    <div v-if="currentView === 'order_detail'" class="fullscreen-page" style="background:#555">
      <van-nav-bar title="å•æ®è¯¦æƒ…" left-text="å…³é—­" left-arrow @click-left="goBack" fixed placeholder></van-nav-bar>
      <div style="padding:20px">
        <div id="capture-area" class="bill-wrapper">
          <div class="bill-title">{{ sysConfig.factory_name || 'å•æ®' }} - {{ curOrder.type==='OUT'?'é€è´§å•':'æ”¶è´§å•' }}</div>
          <div class="logistics-box">
            <div class="log-item">
              <span class="log-label">ğŸ“ å‘è´§æ–¹</span>
              <div>{{ sysConfig.contact_info || 'æ— ' }}</div>
            </div>
            <div class="log-item">
              <span class="log-label">ğŸ‘¤ æ”¶è´§æ–¹</span>
              <div style="font-weight:bold">{{ curOrder.customer_name }}</div>
              <div>{{ curOrder.customer_address }}</div>
            </div>
          </div>
          <div class="bill-header">
            <div style="display:flex;justify-content:space-between">
              <span>å•å·ï¼š{{ curOrder.order_no }}</span>
              <span>{{ curOrder.order_date }}</span>
            </div>
            <div style="margin-top:5px;padding-top:5px;border-top:1px dashed #eee">å¤‡æ³¨ï¼š{{ curOrder.note }}</div>
          </div>
          <table class="detail-table">
            <thead>
              <tr>
                <th>ç‰©èµ„åç§°</th>
                <th>è§„æ ¼</th>
                <th style="text-align:right">æ•°é‡</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="i in curOrder.items" :key="i.name">
                <td><b>{{ i.name }}</b></td>
                <td>{{ i.spec }}</td>
                <td style="text-align:right;font-weight:bold">{{ i.quantity }} {{i.unit||''}}</td>
              </tr>
            </tbody>
          </table>
          <div style="margin-top:40px;display:flex;justify-content:space-between;font-size:12px;padding-top:20px;border-top:2px solid #000">
            <div>å‘è´§äººç­¾å­—ï¼š</div>
            <div>å®¢æˆ·ç­¾å­—ï¼š</div>
          </div>
        </div>
        <div style="margin-top:20px">
          <div style="display: flex; gap: 10px;">
            <van-button block type="primary" @click="generateImage" round>ä¿å­˜ä¸ºå›¾ç‰‡</van-button>
            <van-button block type="primary" @click="exportOrderPDF" round>å¯¼å‡ºPDF</van-button>
            <van-button block type="primary" @click="printOrder" round>ç›´æ¥æ‰“å°</van-button>
          </div>
        </div>
      </div>
    </div>
    <van-popup v-model:show="showProdPicker" position="bottom" round style="height:70%">
      <van-cell v-for="p in products" :key="p.id" :title="p.name" :label="'åº“:'+p.total_stock + (p.unit||'ä¸ª')" is-link @click="addToCart(p)"/>
    </van-popup>
    <van-popup v-model:show="showCustPicker" position="bottom" round>
      <van-picker :columns="custColumns" @confirm="onPickCust" @cancel="showCustPicker=false" title="å®¢æˆ·æ¸…å•"/>
    </van-popup>
    <van-dialog v-model:show="showPayDialog" title="æ”¶æ¬¾ç™»è®°" show-cancel-button @confirm="savePayment">
      <van-field v-model="payForm.amount" type="number" label="é‡‘é¢" />
      <van-field v-model="payForm.note" label="æ‘˜è¦" />
    </van-dialog>
    <van-dialog v-model:show="showImgDialog" title="é•¿æŒ‰ä¿å­˜å›¾ç‰‡" confirm-button-text="å…³é—­">
      <div style="padding:10px;text-align:center;">
        <img :src="imgUrl" style="width:100%;border:1px solid #eee;">
      </div>
    </van-dialog>
    <van-popup v-model:show="showDist" position="bottom" round closeable style="height:45%">
      <div style="padding:20px">
        <h3>ç‰©èµ„åˆ†å¸ƒ</h3>
        <van-cell v-for="h in distList" :key="h.name" :title="h.name" :value="h.quantity+'ä¸ª'" />
      </div>
    </van-popup>
    <van-popup v-model:show="showCategoryPicker" position="bottom" round>
      <div style="padding: 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">
        <h3 style="margin: 0;">é€‰æ‹©åˆ†ç±»</h3>
        <van-button type="primary" size="small" @click="openCategoryMgr">æ–°å¢åˆ†ç±»</van-button>
      </div>
      <van-picker :columns="categoryColumns" @confirm="onPickCategory" @cancel="showCategoryPicker=false" />
    </van-popup>
    <van-popup v-model:show="showCategoryMgr" position="bottom" round closeable style="height:60%">
      <div style="padding:20px">
        <h3>åˆ†ç±»ç®¡ç†</h3>
        <van-cell-group inset>
          <van-field v-model="categoryForm.name" label="åˆ†ç±»åç§°" placeholder="è¯·è¾“å…¥åˆ†ç±»åç§°"/>
          <van-field v-model="categoryForm.description" label="åˆ†ç±»æè¿°" placeholder="è¯·è¾“å…¥åˆ†ç±»æè¿°" type="textarea" rows="2"/>
        </van-cell-group>
        <div style="margin-top:20px">
          <van-button block type="primary" @click="saveCategory" round>ä¿å­˜åˆ†ç±»</van-button>
        </div>
        <div style="margin-top:15px">
          <van-list>
            <van-cell v-for="c in categories" :key="c.id" :title="c.name" :label="c.description" is-link>
              <template #right-icon>
                <div style="display: flex; align-items: center;">
                  <van-icon name="edit" color="#667eea" size="18" @click.stop="editCategory(c)" style="padding-right:12px;"/>
                  <van-icon name="delete-o" color="#ee0a24" size="18" @click.stop="deleteCategory(c.id)"/>
                </div>
              </template>
            </van-cell>
          </van-list>
        </div>
      </div>
    </van-popup>
    <van-popup v-model:show="showProductPicker" position="bottom" round style="height:70%">
      <van-cell v-for="p in products" :key="p.id" :title="p.name" :label="p.spec" is-link @click="() => { repairForm.product_id = p.id; repairForm.product_name = p.name; showProductPicker = false; }"/>
    </van-popup>
    <van-popup v-model:show="showBatchProdPicker" position="bottom" round style="height:80%">
      <div style="padding: 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">
        <h3 style="margin: 0;">æ‰¹é‡é€‰æ‹©ç‰©èµ„</h3>
        <van-button type="primary" size="small" @click="addSelectedProducts">ç¡®å®šæ·»åŠ </van-button>
      </div>
      <div style="padding: 10px;">
        <van-search v-model="batchSearchText" placeholder="æœç´¢ç‰©èµ„åç§°æˆ–è§„æ ¼" background="#fff"></van-search>
        <van-list>
          <van-cell v-for="p in batchFilteredProducts" :key="p.id" :title="p.name" :label="p.spec + ' | åº“å­˜: ' + p.total_stock" center @click="toggleBatchProductSelection(p.id)">
            <template #left>
              <van-checkbox v-model="selectedBatchProducts" :name="p.id" style="margin-right: 10px;" />
            </template>
          </van-cell>
        </van-list>
        <van-empty v-if="!batchFilteredProducts.length" description="æš‚æ— ç‰©èµ„" />
      </div>
    </van-popup>

    <!-- å…¨å±€æœç´¢å¼¹çª— -->
    <van-popup v-model:show="showGlobalSearch" position="top" round closeable style="height: 80vh; margin-top: 50px;">
      <div style="padding: 20px;">
        <h3 style="margin: 0 0 20px 0;">å…¨å±€æœç´¢</h3>
        <van-search v-model="globalSearchText" placeholder="æœç´¢ç‰©èµ„ã€å®¢æˆ·..." background="#fff" shape="round" @input="performGlobalSearch" :show-action="false"></van-search>
        <div v-if="searchLoading" style="text-align: center; padding: 40px;">
          <van-loading size="24px">æœç´¢ä¸­...</van-loading>
        </div>
        <div v-else-if="searchResults.length" style="max-height: 50vh; overflow-y: auto;">
          <van-cell v-for="result in searchResults" :key="result.type + '-' + result.id" :title="result.name" :label="result.desc" is-link @click="openSearchResult(result)">
            <template #left-icon>
              <van-icon :name="result.icon" :color="result.color" style="margin-right: 8px;" />
            </template>
          </van-cell>
        </div>
        <van-empty v-else-if="globalSearchText && !searchLoading" description="æœªæ‰¾åˆ°ç›¸å…³ç»“æœ" />
        <van-empty v-else description="è¯·è¾“å…¥å…³é”®è¯æœç´¢" />
      </div>
    </van-popup>

    <!-- é€šçŸ¥é¢æ¿ -->
    <van-popup v-model:show="showNotificationPanel" position="right" round style="height: 100vh; width: 85%;">
      <div style="padding: 20px; height: 100%; display: flex; flex-direction: column;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h3 style="margin: 0;">ç³»ç»Ÿé€šçŸ¥</h3>
          <van-button type="primary" size="small" @click="markAllNotificationsAsRead" v-if="notificationCount > 0">å…¨éƒ¨å·²è¯»</van-button>
        </div>
        <div style="flex: 1; overflow-y: auto;">
          <van-cell v-for="notif in notifications" :key="notif.id" :title="notif.title" :label="notif.content" :class="notif.is_read ? '' : 'unread-notification'" is-link @click="markNotificationAsRead(notif.id)">
            <template #right-icon>
              <van-tag v-if="!notif.is_read" type="danger" size="small">æ–°</van-tag>
              <div style="font-size: 12px; color: #999;">{{ new Date(notif.create_time).toLocaleString() }}</div>
            </template>
          </van-cell>
          <van-empty v-if="!notifications.length" description="æš‚æ— é€šçŸ¥" />
        </div>
      </div>
    </van-popup>

    <!-- æ“ä½œæ—¥å¿—é¢æ¿ -->
    <van-popup v-model:show="showOperationLogs" position="right" round style="height: 100vh; width: 85%;">
      <div style="padding: 20px; height: 100%; display: flex; flex-direction: column;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h3 style="margin: 0;">æ“ä½œæ—¥å¿—</h3>
          <van-button type="primary" size="small" @click="loadOperationLogs">åˆ·æ–°</van-button>
        </div>
        <div style="flex: 1; overflow-y: auto;">
          <van-timeline>
            <van-timeline-item v-for="log in operationLogs" :key="log.id">
              <div style="font-weight: 600; margin-bottom: 4px;">{{ log.operation_desc }}</div>
              <div style="font-size: 12px; color: #666;">
                <div>ç±»å‹: {{ log.operation_type }}</div>
                <div>æ“ä½œäºº: {{ log.operator || 'ç³»ç»Ÿ' }}</div>
                <div>æ—¶é—´: {{ new Date(log.operation_time).toLocaleString() }}</div>
              </div>
            </van-timeline-item>
          </van-timeline>
          <van-empty v-if="!operationLogs.length" description="æš‚æ— æ“ä½œæ—¥å¿—" />
        </div>
      </div>
    </van-popup>
  </div>
  <script>
    window.onerror = function() { if (typeof Vue === 'undefined' || typeof vant === 'undefined') document.getElementById('error-banner').style.display = 'block'; };
    const { createApp, ref, onMounted, nextTick, computed } = Vue;
    const API = "https://api.xxlb.us.ci"; // ä½¿ç”¨HTTPS APIç«¯ç‚¹
    createApp({
      setup() {
        const currentView = ref('main');
        const activeTab = ref('home');
        const stats = ref({});
        const products = ref([]);
        const customers = ref([]);
        const cart = ref([]);
        const orderType = ref('OUT');
        const orderNote = ref('');
        const orderDeposit = ref(0);
        const selectedCustomerName = ref('');
        const selectedCustomerId = ref(null);
        const showCustPicker = ref(false);
        const showProdPicker = ref(false);
        const showPayDialog = ref(false);
        const showImgDialog = ref(false);
        const showDist = ref(false);
        const showCategoryPicker = ref(false);
        const showCategoryMgr = ref(false);
        const showProductPicker = ref(false);
        const showBatchProdPicker = ref(false);
        const showBatchDeleteDialog = ref(false);
        const showBatchEditDialog = ref(false);
        const showBatchCategoryPicker = ref(false);
        const showCustBatchDeleteDialog = ref(false);
        const showCustCategoryPicker = ref(false);
        const showCreditLevelPicker = ref(false);
        const showCustCategoryMgr = ref(false);
        const selectedProducts = ref([]);
        const selectedCustomers = ref([]);
        const selectedBatchProducts = ref([]);
        const batchSearchText = ref('');
        const custSearchText = ref('');
        const custCategoryForm = ref({});
        const batchForm = ref({});
        const prodForm = ref({});
        const custForm = ref({});
        const configForm = ref({});
        const payForm = ref({});
        const adminPwdInput = ref('');
        const authErrorMsg = ref('');
        const authLoading = ref(false);
        const configLoading = ref(false);
        const exportLoading = ref(false);
        const importLoading = ref(false);
        const categoryForm = ref({});
        const repairForm = ref({});
        const curOrder = ref({ items: [] });
        const proData = ref({});
        const proTabActive = ref(0);
        const searchText = ref('');
        const imgUrl = ref('');
        const loading = ref(false);
        const distList = ref([]);
        const sysConfig = ref({ sys_name: 'è„šæ‰‹æ¶ç®¡å®¶', factory_name: 'æˆ‘çš„ç§Ÿèµç«™', contact_info: '', order_prefix: 'JSJ' });
        const categories = ref([]);
        const repairRecords = ref([]);
        const statsActiveTab = ref(0);
        const categoryStats = ref([]);
        const customerCategoryStats = ref([]);
        const creditStats = ref([]);
        const orderStats = ref([]);
        const customerCategories = ref([]);
        const refreshing = ref(false);
        
        const topCustomers = ref([]);
        const reportTypeText = ref('æŸ±çŠ¶å›¾');
        const dateRangeText = ref('æœ€è¿‘7å¤©');
        const dataTypeText = ref('è®¢å•æ•°æ®');
        const showReportTypePicker = ref(false);
        const showDatePicker = ref(false);
        const showDataTypePicker = ref(false);
        const reportLoading = ref(false);
        const customReportData = ref(null);
        const autoBackupEnabled = ref(false);
        const backupInterval = ref(7);
        const backupLoading = ref(false);
        const lastBackupTime = ref('');
        const backupHistory = ref([]);
        const showRestoreDialog = ref(false);
        const touchFeedbackEnabled = ref(true);
        const gestureEnabled = ref(false);
        
        const showGlobalSearch = ref(false);
        const globalSearchText = ref('');
        const searchResults = ref([]);
        const searchLoading = ref(false);
        const notificationCount = ref(0);
        const notifications = ref([]);
        const showNotificationPanel = ref(false);
        const operationLogs = ref([]);
        const showOperationLogs = ref(false);
        
        const goToPage = (pageName) => { 
          currentView.value = pageName; 
          window.scrollTo(0,0);
          if (pageName === 'stats_page') {
            loadStatsData();
          }
        };
        const goBack = () => { currentView.value = 'main'; };
        const enterGoodsMgr = () => { searchText.value = ''; goToPage('admin_goods_mgr'); };
        const enterCustMgr = () => { goToPage('admin_cust_mgr'); };
        
        const loadData = async () => {
          const get = (u, def) => fetch(API+u).then(r=>r.ok?r.json():def).catch(()=>def);
          const [productsData, customersData, categoriesData, customerCategoriesData, statsData, configData] = await Promise.all([
            get("/products", []),
            get("/customers", []),
            get("/categories", []),
            get("/customer-categories", []),
            get("/stats", {}),
            get("/config", sysConfig.value)
          ]);
          products.value = productsData;
          customers.value = customersData;
          categories.value = categoriesData;
          customerCategories.value = customerCategoriesData;
          stats.value = statsData;
          sysConfig.value = configData;
          document.title = sysConfig.value.sys_name;
          const mask = document.getElementById('loading-mask'); if(mask) mask.style.display='none';
          if(activeTab.value==='home') nextTick(initPie);
          refreshing.value = false;
        };
        
        const getCreditLevelColor = (level) => {
          const colors = {
            'EXCELLENT': '#07c160',
            'GOOD': '#1989fa',
            'NORMAL': '#ff976a',
            'POOR': '#ee0a24'
          };
          return colors[level] || colors['NORMAL'];
        };
        
        const getCreditLevelText = (level) => {
          const texts = {
            'EXCELLENT': 'ä¼˜ç§€',
            'GOOD': 'è‰¯å¥½',
            'NORMAL': 'æ™®é€š',
            'POOR': 'è¾ƒå·®'
          };
          return texts[level] || texts['NORMAL'];
        };
        
        const getCreditLevelBadge = (level) => {
          const badges = {
            'EXCELLENT': 'success',
            'GOOD': 'primary',
            'NORMAL': 'warning',
            'POOR': 'danger'
          };
          return badges[level] || badges['NORMAL'];
        };
        
        const onRefresh = async () => {
          refreshing.value = true;
          await loadData();
        };

        const loadTopCustomers = () => {
          topCustomers.value = [...customers.value]
            .sort((a, b) => Math.abs(b.balance || 0) - Math.abs(a.balance || 0))
            .slice(0, 10);
        };

        const loadStatsData = async () => {
          try {
            const res = await fetch(API + "/stats/detailed");
            if (res.ok) {
              const data = await res.json();
              categoryStats.value = data.categoryStats || [];
              customerCategoryStats.value = data.customerCategoryStats || [];
              creditStats.value = data.creditStats || [];
              orderStats.value = data.orderStats || [];
              loadTopCustomers();
              
              setTimeout(() => {
                initOrderTrendChart();
                initIncomeTrendChart();
                initCategoryChart();
                initCustomerCategoryChart();
                initCreditChart();
                initTurnoverChart();
              }, 100);
            }
          } catch (e) {
            console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:', e);
          }
        };

        const initPie = () => {
          const dom = document.getElementById('chart-pie');
          if (dom && stats.value.total_out !== undefined) {
            echarts.init(dom).setOption({
              series: [{
                type: 'pie',
                radius:['40%','70%'],
                data: [
                  { value: stats.value.total_out, name: 'åœ¨å¤–', itemStyle:{color:'#FF8008'} },
                  { value: stats.value.total_stock, name: 'åœ¨åº“', itemStyle:{color:'#1989fa'} }
                ]
              }]
            });
          }
        };

        const initPieChart = (domId, data, name) => {
          const dom = document.getElementById(domId);
          if (!dom) return;
          
          echarts.init(dom).setOption({
            tooltip: { trigger: 'item' },
            legend: { orient: 'vertical', left: 'left' },
            series: [{
              name: name,
              type: 'pie',
              radius: '60%',
              data: data,
              emphasis: {
                itemStyle: {
                  shadowBlur: 10,
                  shadowOffsetX: 0,
                  shadowColor: 'rgba(0, 0, 0, 0.5)'
                }
              }
            }]
          });
        };

        const initOrderTrendChart = () => {
          const dom = document.getElementById('chart-order-trend');
          if (dom) {
            const dates = orderStats.value.map(item => item.date);
            const counts = orderStats.value.map(item => item.count);
            const deposits = orderStats.value.map(item => item.deposit || 0);
            
            echarts.init(dom).setOption({
              tooltip: {
                trigger: 'axis',
                axisPointer: {
                  type: 'cross',
                  crossStyle: {
                    color: '#999'
                  }
                }
              },
              legend: {
                data: ['è®¢å•æ•°', 'æŠ¼é‡‘é‡‘é¢']
              },
              xAxis: [
                {
                  type: 'category',
                  data: dates,
                  axisPointer: {
                    type: 'shadow'
                  }
                }
              ],
              yAxis: [
                {
                  type: 'value',
                  name: 'è®¢å•æ•°',
                  min: 0,
                  axisLabel: {
                    formatter: '{value}'
                  }
                },
                {
                  type: 'value',
                  name: 'æŠ¼é‡‘',
                  min: 0,
                  axisLabel: {
                    formatter: 'Â¥{value}'
                  }
                }
              ],
              series: [
                {
                  name: 'è®¢å•æ•°',
                  type: 'bar',
                  data: counts,
                  itemStyle: {
                    color: '#1989fa'
                  }
                },
                {
                  name: 'æŠ¼é‡‘é‡‘é¢',
                  type: 'line',
                  yAxisIndex: 1,
                  data: deposits,
                  itemStyle: {
                    color: '#ff976a'
                  }
                }
              ]
            });
          }
        };

        const initCategoryChart = () => {
          const data = categoryStats.value.map(item => ({
            name: item.category || 'æœªåˆ†ç±»',
            value: item.count
          }));
          initPieChart('chart-category', data, 'ç‰©èµ„åˆ†ç±»');
        };

        const initCustomerCategoryChart = () => {
          const data = customerCategoryStats.value.map(item => ({
            name: item.category || 'æœªåˆ†ç±»',
            value: item.count
          }));
          initPieChart('chart-customer-category', data, 'å®¢æˆ·åˆ†ç±»');
        };

        const initCreditChart = () => {
          const data = creditStats.value.map(item => ({
            name: getCreditLevelText(item.credit_level),
            value: item.count
          }));
          initPieChart('chart-credit', data, 'ä¿¡ç”¨ç­‰çº§');
        };

        const initIncomeTrendChart = () => {
          const dom = document.getElementById('chart-income-trend');
          if (dom && orderStats.value.length) {
            const dates = orderStats.value.map(item => item.date);
            const deposits = orderStats.value.map(item => item.deposit || 0);
            
            echarts.init(dom).setOption({
              tooltip: {
                trigger: 'axis'
              },
              xAxis: {
                type: 'category',
                data: dates
              },
              yAxis: {
                type: 'value',
                name: 'é‡‘é¢(å…ƒ)'
              },
              series: [{
                name: 'æŠ¼é‡‘æ”¶å…¥',
                type: 'line',
                data: deposits,
                smooth: true,
                itemStyle: {
                  color: '#1989fa'
                },
                areaStyle: {
                  color: {
                    type: 'linear',
                    x: 0,
                    y: 0,
                    x2: 0,
                    y2: 1,
                    colorStops: [{
                      offset: 0, color: 'rgba(25, 137, 250, 0.3)'
                    }, {
                      offset: 1, color: 'rgba(25, 137, 250, 0.1)'
                    }]
                  }
                }
              }]
            });
          }
        };

        const initTurnoverChart = () => {
          const dom = document.getElementById('chart-turnover');
          if (dom && categoryStats.value.length) {
            const categories = categoryStats.value.map(item => item.category || 'æœªåˆ†ç±»');
            const stocks = categoryStats.value.map(item => item.total_stock || 0);
            const counts = categoryStats.value.map(item => item.count || 0);
            
            echarts.init(dom).setOption({
              tooltip: {
                trigger: 'axis',
                axisPointer: {
                  type: 'shadow'
                }
              },
              legend: {
                data: ['åº“å­˜æ•°é‡', 'ç‰©èµ„ç§ç±»']
              },
              xAxis: {
                type: 'category',
                data: categories
              },
              yAxis: {
                type: 'value'
              },
              series: [
                {
                  name: 'åº“å­˜æ•°é‡',
                  type: 'bar',
                  data: stocks,
                  itemStyle: {
                    color: '#1989fa'
                  }
                },
                {
                  name: 'ç‰©èµ„ç§ç±»',
                  type: 'line',
                  data: counts,
                  itemStyle: {
                    color: '#ff976a'
                  }
                }
              ]
            });
          }
        };

        const exportPDF = async () => {
          try {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(20);
            doc.text('è„šæ‰‹æ¶ç§Ÿèµç®¡ç†ç³»ç»Ÿ - æ•°æ®ç»Ÿè®¡æŠ¥è¡¨', 20, 20);
            
            doc.setFontSize(12);
            doc.text('ç”Ÿæˆæ—¶é—´: ' + new Date().toLocaleString(), 20, 30);
            
            doc.setFontSize(14);
            doc.text('ä¸šåŠ¡æ¦‚è§ˆ', 20, 45);
            
            doc.setFontSize(11);
            doc.text('æ—¥ç§Ÿé‡‘é¢„è®¡: Â¥' + (stats.value.daily_income || 0).toFixed(2), 25, 55);
            doc.text('åœ¨å¤–ç‰©èµ„æ€»æ•°: ' + (stats.value.total_out || 0), 25, 62);
            doc.text('ç‰©èµ„æ€»æ•°: ' + products.value.length, 25, 69);
            doc.text('å®¢æˆ·æ€»æ•°: ' + customers.value.length, 25, 76);
            
            doc.setFontSize(14);
            doc.text('ç‰©èµ„åˆ†ç±»ç»Ÿè®¡', 20, 90);
            
            let yPos = 100;
            categoryStats.value.forEach((item, index) => {
              if (yPos > 270) {
                doc.addPage();
                yPos = 20;
              }
              doc.setFontSize(11);
              doc.text((index + 1) + '. ' + (item.category || 'æœªåˆ†ç±»') + ': ' + item.total_stock + 'ä¸ª', 25, yPos);
              yPos += 7;
            });
            
            doc.save('æ•°æ®ç»Ÿè®¡æŠ¥è¡¨_' + new Date().toISOString().split('T')[0] + '.pdf');
          } catch (e) {
            vant.showToast({
              message: 'å¯¼å‡ºPDFå¤±è´¥: ' + e.message,
              position: 'top'
            });
          }
        };

        const generateCustomReport = async () => {
          try {
            reportLoading.value = true;
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            customReportData.value = {
              type: reportTypeText.value,
              dateRange: dateRangeText.value,
              dataType: dataTypeText.value,
              data: orderStats.value
            };
            
            nextTick(() => {
              const dom = document.getElementById('custom-report-chart');
              if (dom) {
                const chartType = reportTypeText.value === 'æŸ±çŠ¶å›¾' ? 'bar' : 
                                 reportTypeText.value === 'æŠ˜çº¿å›¾' ? 'line' : 'pie';
                
                const chartData = orderStats.value.map(item => ({
                  name: item.date,
                  value: item.count
                }));
                
                echarts.init(dom).setOption({
                  tooltip: {
                    trigger: chartType === 'pie' ? 'item' : 'axis'
                  },
                  xAxis: chartType === 'pie' ? undefined : {
                    type: 'category',
                    data: orderStats.value.map(item => item.date)
                  },
                  yAxis: chartType === 'pie' ? undefined : {
                    type: 'value'
                  },
                  series: [{
                    type: chartType,
                    data: chartData,
                    itemStyle: {
                      color: '#1989fa'
                    }
                  }]
                });
              }
            });
            
            vant.showToast({
              message: 'æŠ¥è¡¨ç”ŸæˆæˆåŠŸ',
              position: 'top'
            });
          } catch (e) {
            vant.showToast({
              message: 'ç”ŸæˆæŠ¥è¡¨å¤±è´¥: ' + e.message,
              position: 'top'
            });
          } finally {
            reportLoading.value = false;
          }
        };

        const exportCustomReport = async () => {
          try {
            if (!customReportData.value) return;
            
            const data = customReportData.value.data;
            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'æŠ¥è¡¨æ•°æ®');
            XLSX.writeFile(wb, 'è‡ªå®šä¹‰æŠ¥è¡¨_' + new Date().toISOString().split('T')[0] + '.xlsx');
            
            vant.showToast({
              message: 'æŠ¥è¡¨å¯¼å‡ºæˆåŠŸ',
              position: 'top'
            });
          } catch (e) {
            vant.showToast({
              message: 'å¯¼å‡ºæŠ¥è¡¨å¤±è´¥: ' + e.message,
              position: 'top'
            });
          }
        };

        const createBackup = async () => {
          try {
            backupLoading.value = true;
            
            const backupData = {
              timestamp: new Date().toISOString(),
              products: products.value,
              customers: customers.value,
              categories: categories.value,
              customerCategories: customerCategories.value,
              sysConfig: sysConfig.value
            };
            
            const backupName = 'backup_' + new Date().toISOString().replace(/[:.]/g, '-') + '.json';
            const backupDate = new Date().toLocaleString();
            
            backupHistory.value.unshift({
              name: backupName,
              date: backupDate,
              data: backupData
            });
            
            if (backupHistory.value.length > 10) {
              backupHistory.value = backupHistory.value.slice(0, 10);
            }
            
            lastBackupTime.value = backupDate;
            
            const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = backupName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            vant.showToast({
              message: 'å¤‡ä»½åˆ›å»ºæˆåŠŸ',
              position: 'top'
            });
          } catch (e) {
            vant.showToast({
              message: 'åˆ›å»ºå¤‡ä»½å¤±è´¥: ' + e.message,
              position: 'top'
            });
          } finally {
            backupLoading.value = false;
          }
        };

        const restoreBackup = async (index) => {
          try {
            const backup = backupHistory.value[index];
            if (!backup) return;
            
            await vant.showConfirmDialog({
              title: 'ç¡®è®¤æ¢å¤',
              message: 'ç¡®å®šè¦æ¢å¤ ' + backup.date + ' çš„å¤‡ä»½å—ï¼Ÿæ­¤æ“ä½œå°†è¦†ç›–å½“å‰æ•°æ®ã€‚'
            });
            
            vant.showLoadingToast({
              message: 'æ­£åœ¨æ¢å¤å¤‡ä»½...',
              forbidClick: true
            });
            
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            products.value = backup.data.products || [];
            customers.value = backup.data.customers || [];
            categories.value = backup.data.categories || [];
            customerCategories.value = backup.data.customerCategories || [];
            sysConfig.value = backup.data.sysConfig || sysConfig.value;
            
            vant.showToast({
              message: 'å¤‡ä»½æ¢å¤æˆåŠŸ',
              position: 'top'
            });
          } catch (e) {
            vant.showToast({
              message: 'æ¢å¤å¤‡ä»½å¤±è´¥: ' + e.message,
              position: 'top'
            });
          }
        };

        const setupTouchFeedback = () => {
          if (!touchFeedbackEnabled.value) return;
          
          const addTouchFeedback = (selector) => {
            const elements = document.querySelectorAll(selector);
            elements.forEach(el => {
              el.addEventListener('touchstart', () => {
                el.style.opacity = '0.7';
              });
              el.addEventListener('touchend', () => {
                el.style.opacity = '1';
              });
            });
          };
          
          addTouchFeedback('.card');
          addTouchFeedback('.admin-card');
          addTouchFeedback('.van-button');
          addTouchFeedback('.van-cell');
        };

        const setupGestureSupport = () => {
          if (!gestureEnabled.value) return;
          
          let startX = 0;
          let startY = 0;
          let currentViewIndex = 0;
          const views = ['home', 'order', 'goods', 'customers'];
          
          const handleGesture = (e) => {
            if (currentView.value !== 'main') return;
            
            const endX = e.changedTouches[0].clientX;
            const endY = e.changedTouches[0].clientY;
            const diffX = endX - startX;
            const diffY = endY - startY;
            
            if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
              if (diffX > 0 && currentViewIndex > 0) {
                currentViewIndex--;
                activeTab.value = views[currentViewIndex];
              } else if (diffX < 0 && currentViewIndex < views.length - 1) {
                currentViewIndex++;
                activeTab.value = views[currentViewIndex];
              }
              
              showGestureHint();
            }
          };
          
          document.addEventListener('touchstart', (e) => {
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
          });
          
          document.addEventListener('touchend', handleGesture);
        };

        const showGestureHint = () => {
          const hint = document.getElementById('gesture-hint');
          if (hint) {
            hint.classList.add('show');
            setTimeout(() => {
              hint.classList.remove('show');
            }, 1500);
          }
        };

        const optimizeMobileNavigation = () => {
          const tabbar = document.querySelector('.van-tabbar');
          if (tabbar) {
            tabbar.style.paddingBottom = 'env(safe-area-inset-bottom)';
          }
          
          const inputs = document.querySelectorAll('input, textarea');
          inputs.forEach(input => {
            input.style.fontSize = '16px';
          });
        };



        const openGoodsEditorPage = (p) => {
          if (p) {
            prodForm.value = {...p};
            const category = categories.value.find(c => c.id === p.category_id);
            prodForm.value.category_name = category ? category.name : '';
          } else {
            prodForm.value = {name:'', spec:'', unit:'ä¸ª', total_stock:0, daily_rent_price:0, unit_price:0, category_id:0, deposit_price:0, weight:0, min_stock:0, category_name:''};
          }
          goToPage('goods_edit');
        };

        const saveProd = async () => {
          await fetch(API+"/products",{method:prodForm.value.id?'PUT':'POST',body:JSON.stringify(prodForm.value)});
          goToPage('admin_goods_mgr');
          loadData();
        };

        const deleteProd = async () => {
          if(confirm('ç¡®è®¤åˆ é™¤?')){
            await fetch(API+"/products?id="+prodForm.value.id,{method:"DELETE"});
            goToPage('admin_goods_mgr');
            loadData();
          }
        };

        const toggleProductSelection = (productId) => {
          const index = selectedProducts.value.indexOf(productId);
          if (index > -1) {
            selectedProducts.value.splice(index, 1);
          } else {
            selectedProducts.value.push(productId);
          }
        };

        const batchDeleteProducts = async () => {
          for (const productId of selectedProducts.value) {
            await fetch(API+"/products?id="+productId,{method:"DELETE"});
          }
          selectedProducts.value = [];
          showBatchDeleteDialog.value = false;
          loadData();
        };

        const onPickBatchCategory = ({ selectedOptions }) => {
          if(selectedOptions[0]){
            batchForm.value.category_id = selectedOptions[0].value;
            const category = categories.value.find(c => c.id === selectedOptions[0].value);
            batchForm.value.category_name = category ? category.name : '';
          }
          showBatchCategoryPicker.value = false;
        };

        const batchUpdateProducts = async () => {
          if (selectedProducts.value.length === 0) {
            vant.showFailToast('è¯·é€‰æ‹©ç‰©èµ„');
            return;
          }
          
          const batchData = { ...batchForm.value };
          
          for (const productId of selectedProducts.value) {
            try {
              const product = products.value.find(p => p.id === productId);
              if (!product) continue;
              
              const updateData = {
                id: productId,
                name: product.name,
                spec: product.spec,
                total_stock: product.total_stock,
                daily_rent_price: product.daily_rent_price,
                unit_price: product.unit_price,
                category_id: product.category_id,
                deposit_price: product.deposit_price,
                unit: product.unit,
                weight: product.weight,
                min_stock: product.min_stock
              };
              
              if (batchData.daily_rent_price) updateData.daily_rent_price = Number(batchData.daily_rent_price);
              if (batchData.unit_price) updateData.unit_price = Number(batchData.unit_price);
              if (batchData.unit) updateData.unit = batchData.unit;
              if (batchData.category_id) updateData.category_id = batchData.category_id;
              
              if (batchData.stock_change) {
                updateData.total_stock = product.total_stock + Number(batchData.stock_change);
                if (updateData.total_stock < 0) updateData.total_stock = 0;
              }
              
              await fetch(API+"/products", { method: "PUT", body: JSON.stringify(updateData) });
            } catch (e) {
              console.error('æ‰¹é‡æ›´æ–°å¤±è´¥:', e);
            }
          }
          
          batchForm.value = {};
          selectedProducts.value = [];
          showBatchEditDialog.value = false;
          
          await loadData();
          vant.showSuccessToast('æˆåŠŸæ›´æ–°ç‰©èµ„');
        };

        const showDistribution = async(p)=>{
          distList.value=await fetch(API+"/products/"+p.id+"/distribution").then(r=>r.json());
          showDist.value=true;
        };

        const openCustEditorPage = (c) => {
          if (c) {
            custForm.value = {...c};
            const category = customerCategories.value.find(cc => cc.id === c.category_id);
            custForm.value.category_name = category ? category.name : '';
            custForm.value.credit_level_text = getCreditLevelText(c.credit_level);
          } else {
            custForm.value = {
              name:'', 
              contact:'', 
              address:'', 
              id_card:'', 
              project_name:'', 
              notes:'',
              category_id: 0,
              category_name: '',
              credit_level: 'NORMAL',
              credit_level_text: 'æ™®é€š'
            };
          }
          goToPage('cust_edit');
        };

        const saveCustomer = async () => {
          await fetch(API+"/customers",{method:custForm.value.id?'PUT':'POST',body:JSON.stringify(custForm.value)});
          goToPage('admin_cust_mgr');
          loadData();
        };

        const toggleCustomerSelection = (customerId) => {
          const index = selectedCustomers.value.indexOf(customerId);
          if (index > -1) {
            selectedCustomers.value.splice(index, 1);
          } else {
            selectedCustomers.value.push(customerId);
          }
        };

        const batchDeleteCustomers = async () => {
          for (const customerId of selectedCustomers.value) {
            await fetch(API+"/customers?id="+customerId,{method:"DELETE"});
          }
          selectedCustomers.value = [];
          showCustBatchDeleteDialog.value = false;
          loadData();
        };

        const openProjectPage = async (c) => {
          proData.value = await fetch(API+"/customers/"+c.id+"/financial").then(r=>r.json());
          goToPage('project_detail');
        };

        const onPickCust = ({ selectedOptions }) => {
          if(selectedOptions[0]){
            selectedCustomerName.value = selectedOptions[0].text;
            selectedCustomerId.value = selectedOptions[0].value;
          }
          showCustPicker.value = false;
        };

        const onPickCategory = ({ selectedOptions }) => {
          if(selectedOptions[0]){
            prodForm.value.category_name = selectedOptions[0].text;
            prodForm.value.category_id = selectedOptions[0].value;
          }
          showCategoryPicker.value = false;
        };

        const onPickCustCategory = ({ selectedOptions }) => {
          if(selectedOptions[0]){
            custForm.value.category_name = selectedOptions[0].text;
            custForm.value.category_id = selectedOptions[0].value;
          }
          showCustCategoryPicker.value = false;
        };

        const onPickCreditLevel = ({ selectedOptions }) => {
          if(selectedOptions[0]){
            custForm.value.credit_level_text = selectedOptions[0].text;
            custForm.value.credit_level = selectedOptions[0].value;
          }
          showCreditLevelPicker.value = false;
        };

        const openCategoryMgr = () => {
          categoryForm.value = {};
          showCategoryMgr.value = true;
        };

        const openCustCategoryMgr = () => {
          custCategoryForm.value = {};
          showCustCategoryMgr.value = true;
        };

        const saveCustCategory = async () => {
          if (!custCategoryForm.value.name) {
            vant.showFailToast('è¯·è¾“å…¥åˆ†ç±»åç§°');
            return;
          }
          await fetch(API+"/customer-categories",{method:custCategoryForm.value.id?'PUT':'POST',body:JSON.stringify(custCategoryForm.value)});
          showCustCategoryMgr.value = false;
          await loadData();
          vant.showSuccessToast('ä¿å­˜æˆåŠŸ');
        };

        const saveCategory = async () => {
          await fetch(API+"/categories",{method:categoryForm.value.id?'PUT':'POST',body:JSON.stringify(categoryForm.value)});
          showCategoryMgr.value = false;
          loadData();
        };

        const editCategory = (c) => {
          categoryForm.value = { ...c };
        };

        const deleteCategory = async (id) => {
          if (confirm('ç¡®è®¤åˆ é™¤è¯¥åˆ†ç±»ï¼Ÿ')) {
            await fetch(API + "/categories?id=" + id, { method: "DELETE" });
            await loadData();
            vant.showSuccessToast('åˆ é™¤æˆåŠŸ');
          }
        };

        const openRepairRecord = async (p) => {
          try {
            if (p) {
              const res = await fetch(API + "/product-repairs?product_id=" + p.id);
              repairRecords.value = await res.json();
            } else {
              const res = await fetch(API + "/product-repairs");
              repairRecords.value = await res.json();
            }
          } catch (e) {
            repairRecords.value = [];
          }
          goToPage('repair_record');
        };

        const openRepairEditor = (r) => {
          if (r) {
            repairForm.value = {...r};
          } else {
            repairForm.value = {product_id:0, product_name:'', description:'', cost:0, status:'PENDING'};
          }
          goToPage('repair_edit');
        };

        const saveRepair = async () => {
          await fetch(API+"/product-repairs",{method:repairForm.value.id?'PUT':'POST',body:JSON.stringify(repairForm.value)});
          goToPage('repair_record');
        };

        const addToCart = (p) => {
          if (!cart.value.find(x => x.id === p.id)) {
            cart.value.push({ ...p, qty: 1 });
          }
          showProdPicker.value = false;
        };

        const toggleBatchProductSelection = (productId) => {
          const index = selectedBatchProducts.value.indexOf(productId);
          if (index > -1) {
            selectedBatchProducts.value.splice(index, 1);
          } else {
            selectedBatchProducts.value.push(productId);
          }
        };

        const addSelectedProducts = () => {
          if (selectedBatchProducts.value.length === 0) {
            vant.showFailToast('è¯·é€‰æ‹©ç‰©èµ„');
            return;
          }
          
          const selectedItems = products.value.filter(p => selectedBatchProducts.value.includes(p.id));
          for (const item of selectedItems) {
            if (!cart.value.find(x => x.id === item.id)) {
              cart.value.push({ ...item, qty: 1 });
            }
          }
          
          selectedBatchProducts.value = [];
          batchSearchText.value = '';
          showBatchProdPicker.value = false;
          vant.showSuccessToast('æˆåŠŸæ·»åŠ ç‰©èµ„');
        };

        const submitOrder = async () => {
          if(!selectedCustomerId.value || !cart.value.length) return vant.showFailToast('è¯·å®Œå–„å•æ®');
          loading.value = true;
          const payload = { 
            customer_id: selectedCustomerId.value, 
            type: orderType.value, 
            note: orderNote.value, 
            deposit: Number(orderDeposit.value), 
            items: cart.value.map(x=>({product_id:x.id, qty:x.qty, daily_rent_price: x.daily_rent_price})) 
          };
          const res = await fetch(API+"/orders", {method:"POST", body:JSON.stringify(payload)});
          if(res.ok) {
            await loadData();
            cart.value = [];
            orderDeposit.value=0;
            showOrderDetailPage(stats.value.recent_orders[0]?.id);
          }
          loading.value = false;
        };

        const showOrderDetailPage = async(id)=>{
          try {
            curOrder.value = await fetch(API+"/orders/"+id).then(r=>r.json());
            goToPage('order_detail');
          } catch(e) {}
        };

        const doAdminAuth = async () => {
          if (!adminPwdInput.value) {
            authErrorMsg.value = 'è¯·è¾“å…¥ç®¡ç†å¯†ç ';
            return;
          }
          authLoading.value = true;
          try {
            const res = await fetch(API+"/auth", { method:'POST', body:JSON.stringify({ pwd: adminPwdInput.value }) });
            const data = await res.json();
            if(data.success) {
              configForm.value = { ...sysConfig.value, old_pwd: adminPwdInput.value, new_pwd: '', confirm_pwd: '' };
              authErrorMsg.value = '';
              goToPage('admin_panel');
            } else {
              authErrorMsg.value = 'å¯†ç é”™è¯¯';
            }
          } catch(e) {
            authErrorMsg.value = 'ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¿æ¥';
          } finally {
            authLoading.value = false;
          }
        };

        const saveConfig = async () => {
          if (!configForm.value.sys_name) {
            vant.showFailToast('è¯·è¾“å…¥ç³»ç»Ÿåç§°');
            return;
          }
          if (!configForm.value.old_pwd) {
            vant.showFailToast('è¯·è¾“å…¥å½“å‰å¯†ç ');
            return;
          }
          if (configForm.value.new_pwd && configForm.value.new_pwd !== configForm.value.confirm_pwd) {
            vant.showFailToast('ä¸¤æ¬¡è¾“å…¥çš„æ–°å¯†ç ä¸ä¸€è‡´');
            return;
          }
          configLoading.value = true;
          try {
            const res = await fetch(API+"/config", { method:'POST', body:JSON.stringify(configForm.value) });
            const data = await res.json();
            if(data.success) {
              vant.showSuccessToast('ä¿å­˜æˆåŠŸ');
              await loadData();
              goBack();
            } else {
              vant.showFailToast(data.error || 'ä¿å­˜å¤±è´¥');
            }
          } catch(e) {
            vant.showFailToast('ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¿æ¥');
          } finally {
            configLoading.value = false;
          }
        };

        const autoPrefix = () => {
          if (configForm.value.sys_name && !configForm.value.order_prefix) {
            configForm.value.order_prefix = 'JSJ';
          }
        };

        const savePayment = async () => {
          try {
            await fetch(API+"/payments",{method:"POST",body:JSON.stringify({customer_id:proData.value.cust.id,amount:Number(payForm.value.amount),note:payForm.value.note})});
            openProjectPage(proData.value.cust);
            loadData();
            showPayDialog.value=false;
            vant.showSuccessToast('æ”¶æ¬¾æˆåŠŸ');
          } catch(e) {
            vant.showFailToast('ç½‘ç»œé”™è¯¯');
          }
        };

        const exportExcel = () => {
          const wb = XLSX.utils.book_new();
          XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet([{ å®¢æˆ·: proData.value.cust.name, ä½™é¢: proData.value.cust.balance }]), "æ¦‚è§ˆ");
          if (proData.value.stocks.length) {
            XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(proData.value.stocks.map(s => ({ ç‰©èµ„: s.name, è§„æ ¼: s.spec, æ•°é‡: s.quantity, åŸå€¼: s.unit_price }))), "æ¸…å•");
          }
          XLSX.writeFile(wb, proData.value.cust.name + ".xlsx");
        };

        const generateImage = async () => {
          const el = document.getElementById('capture-area');
          try {
            const canvas = await html2canvas(el, { scale: 2 });
            imgUrl.value = canvas.toDataURL("image/png");
            showImgDialog.value = true;
          } catch(e) {
            vant.showFailToast('å¤±è´¥');
          }
        };

        const exportOrderPDF = async () => {
          const el = document.getElementById('capture-area');
          try {
            const canvas = await html2canvas(el, { scale: 2 });
            const imgData = canvas.toDataURL('image/png');
            
            // è®¡ç®—PDFå°ºå¯¸
            const imgWidth = 210;
            const pageHeight = 297;
            const imgHeight = (canvas.height * imgWidth) / canvas.width;
            let heightLeft = imgHeight;
            
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            let position = 0;
            
            pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
            heightLeft -= pageHeight;
            
            while (heightLeft >= 0) {
              position = heightLeft - imgHeight;
              pdf.addPage();
              pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
              heightLeft -= pageHeight;
            }
            
            pdf.save('è®¢å•_' + curOrder.value.order_no + '.pdf');
            vant.showSuccessToast('PDFå¯¼å‡ºæˆåŠŸ');
          } catch(e) {
            console.error('PDFå¯¼å‡ºå¤±è´¥:', e);
            vant.showFailToast('PDFå¯¼å‡ºå¤±è´¥');
          }
        };

        const printOrder = () => {
          const el = document.getElementById('capture-area');
          const originalContent = document.body.innerHTML;
          
          try {
            // åˆ›å»ºæ‰“å°çª—å£
            const printWindow = window.open('', '_blank');
            printWindow.document.write('<html><head><title>è®¢å•æ‰“å°</title>');
            printWindow.document.write('<style>');
            printWindow.document.write('body { font-family: Arial, sans-serif; margin: 20px; }');
            printWindow.document.write('.bill-wrapper { max-width: 800px; margin: 0 auto; }');
            printWindow.document.write('.detail-table { width: 100%; border-collapse: collapse; }');
            printWindow.document.write('.detail-table th, .detail-table td { border: 1px solid #ddd; padding: 8px; }');
            printWindow.document.write('</style>');
            printWindow.document.write('</head><body>');
            printWindow.document.write(el.innerHTML);
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            
            // æ‰§è¡Œæ‰“å°
            printWindow.print();
            printWindow.close();
          } catch (e) {
            console.error('æ‰“å°å¤±è´¥:', e);
            vant.showFailToast('æ‰“å°å¤±è´¥');
          }
        };

        const exportData = async (type) => {
          exportLoading.value = true;
          try {
            const res = await fetch(API + "/export?type=" + type);
            if (!res.ok) {
              throw new Error('å¯¼å‡ºå¤±è´¥');
            }
            const data = await res.json();
            if (!data || data.length === 0) {
              vant.showFailToast('æ²¡æœ‰å¯å¯¼å‡ºçš„æ•°æ®');
              return;
            }
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = type + '_' + new Date().toISOString().split('T')[0] + '.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            vant.showSuccessToast('å¯¼å‡ºæˆåŠŸ');
          } catch(e) {
            vant.showFailToast('å¯¼å‡ºå¤±è´¥ï¼š' + e.message);
          } finally {
            exportLoading.value = false;
          }
        };

        const importData = async (event) => {
          const file = event.target.files[0];
          if (!file) return;
          importLoading.value = true;
          try {
            const reader = new FileReader();
            reader.onload = async (e) => {
              try {
                const data = JSON.parse(e.target.result);
                if (!Array.isArray(data) || data.length === 0) {
                  vant.showFailToast('æ–‡ä»¶æ ¼å¼é”™è¯¯æˆ–æ•°æ®ä¸ºç©º');
                  return;
                }
                let type = '';
                const firstItem = data[0];
                if (firstItem.name && firstItem.total_stock !== undefined) {
                  type = 'products';
                } else if (firstItem.name && firstItem.balance !== undefined) {
                  type = 'customers';
                } else {
                  vant.showFailToast('æ–‡ä»¶æ ¼å¼é”™è¯¯');
                  return;
                }
                const res = await fetch(API + "/import", {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify({ type, data })
                });
                const result = await res.json();
                if (result.success) {
                  vant.showSuccessToast('å¯¼å…¥æˆåŠŸï¼Œå…±å¯¼å…¥ ' + data.length + ' æ¡æ•°æ®');
                  await loadData();
                } else {
                  vant.showFailToast('å¯¼å…¥å¤±è´¥');
                }
              } catch(e) {
                vant.showFailToast('æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼š' + e.message);
              } finally {
                importLoading.value = false;
              }
            };
            reader.readAsText(file);
          } catch(e) {
            vant.showFailToast('å¯¼å…¥å¤±è´¥ï¼š' + e.message);
            importLoading.value = false;
          }
          event.target.value = '';
        };

        const loadNotifications = async () => {
          try {
            const res = await fetch(API + "/notifications/unread-count");
            if (res.ok) {
              const data = await res.json();
              notificationCount.value = data.count || 0;
            }
          } catch (e) {
            console.error('åŠ è½½é€šçŸ¥æ•°é‡å¤±è´¥:', e);
          }
        };

        const loadAllNotifications = async () => {
          try {
            const res = await fetch(API + "/notifications");
            if (res.ok) {
              notifications.value = await res.json();
            }
          } catch (e) {
            console.error('åŠ è½½é€šçŸ¥å¤±è´¥:', e);
          }
        };

        const markNotificationAsRead = async (id) => {
          try {
            await fetch(API + "/notifications", {
              method: "PUT",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ id })
            });
            notificationCount.value = Math.max(0, notificationCount.value - 1);
            await loadAllNotifications();
          } catch (e) {
            console.error('æ ‡è®°é€šçŸ¥å¤±è´¥:', e);
          }
        };

        const markAllNotificationsAsRead = async () => {
          try {
            await fetch(API + "/notifications", {
              method: "PUT",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({})
            });
            notificationCount.value = 0;
            await loadAllNotifications();
          } catch (e) {
            console.error('æ ‡è®°æ‰€æœ‰é€šçŸ¥å¤±è´¥:', e);
          }
        };

        const loadOperationLogs = async () => {
          try {
            const res = await fetch(API + "/operation-logs?limit=50");
            if (res.ok) {
              operationLogs.value = await res.json();
            }
          } catch (e) {
            console.error('åŠ è½½æ“ä½œæ—¥å¿—å¤±è´¥:', e);
          }
        };

        const performGlobalSearch = async () => {
          if (!globalSearchText.value.trim()) {
            searchResults.value = [];
            return;
          }
          
          searchLoading.value = true;
          try {
            const query = globalSearchText.value.toLowerCase();
            const results = [];
            
            products.value.forEach(p => {
              if (p.name.toLowerCase().includes(query) || 
                  (p.spec && p.spec.toLowerCase().includes(query))) {
                results.push({
                  type: 'product',
                  id: p.id,
                  name: p.name,
                  desc: p.spec || '',
                  icon: 'points',
                  color: '#667eea'
                });
              }
            });
            
            customers.value.forEach(c => {
              if (c.name.toLowerCase().includes(query) || 
                  (c.contact && c.contact.toLowerCase().includes(query)) ||
                  (c.project_name && c.project_name.toLowerCase().includes(query))) {
                results.push({
                  type: 'customer',
                  id: c.id,
                  name: c.name,
                  desc: c.contact || c.project_name || '',
                  icon: 'friends-o',
                  color: '#11998e'
                });
              }
            });
            
            searchResults.value = results.slice(0, 20);
          } catch (e) {
            console.error('æœç´¢å¤±è´¥:', e);
            searchResults.value = [];
          } finally {
            searchLoading.value = false;
          }
        };

        const openSearchResult = (result) => {
          showGlobalSearch.value = false;
          globalSearchText.value = '';
          searchResults.value = [];
          
          if (result.type === 'product') {
            const product = products.value.find(p => p.id === result.id);
            if (product) {
              openGoodsEditorPage(product);
            }
          } else if (result.type === 'customer') {
            const customer = customers.value.find(c => c.id === result.id);
            if (customer) {
              openCustEditorPage(customer);
            }
          }
        };

        onMounted(() => {
          loadData();
          loadNotifications();
          loadOperationLogs();
          setupTouchFeedback();
          setupGestureSupport();
          optimizeMobileNavigation();
        });

        return {
          currentView, activeTab, stats, products, customers, cart, orderType, orderNote, orderDeposit, selectedCustomerName, selectedCustomerId,
          proTabActive, proData, showCustPicker, showProdPicker, showDist, showPayDialog, showImgDialog, showCategoryPicker, showCategoryMgr, showProductPicker, showBatchDeleteDialog, showCustBatchDeleteDialog, selectedProducts, selectedCustomers, custSearchText,
          custForm, prodForm, curOrder, distList, payForm, searchText, imgUrl, loading, sysConfig, configForm, adminPwdInput, authErrorMsg, authLoading, configLoading, exportLoading, importLoading, categoryForm, categories, repairForm, repairRecords, refreshing, batchSearchText, selectedBatchProducts, showBatchProdPicker,
          custColumns: computed(()=>customers.value.map(c=>({text:c.name,value:c.id}))),
          categoryColumns: computed(()=>categories.value.map(c=>({text:c.name,value:c.id}))),
          filteredProducts: computed(()=>products.value.filter(p=>(p.name+(p.spec||'')+(p.category_name||'')).toLowerCase().includes(searchText.value.toLowerCase()))),
          filteredCustomers: computed(()=>customers.value.filter(c=>(c.name+(c.contact||'')+(c.project_name||'')).toLowerCase().includes(custSearchText.value.toLowerCase()))),
          batchFilteredProducts: computed(()=>products.value.filter(p=>(p.name+(p.spec||'')).toLowerCase().includes(batchSearchText.value.toLowerCase()))),
          custCategoryColumns: computed(()=>customerCategories.value.map(c=>({text:c.name,value:c.id}))),
          creditLevelColumns: computed(()=>[
            { text: 'ä¼˜ç§€', value: 'EXCELLENT' },
            { text: 'è‰¯å¥½', value: 'GOOD' },
            { text: 'æ™®é€š', value: 'NORMAL' },
            { text: 'è¾ƒå·®', value: 'POOR' }
          ]),
          onPickCust, onPickCategory, addToCart, submitOrder, loadData, onTabChange: (name)=>{ if(name==='home') nextTick(initPie); loadData(); },
          goToPage, goBack, enterGoodsMgr, enterCustMgr, openGoodsEditorPage, saveProd, deleteProd, openCustEditorPage, saveCustomer, openProjectPage,
          savePayment, showOrderDetailPage, exportExcel, generateImage, exportOrderPDF, printOrder, showDistribution,
          doAdminAuth, saveConfig, autoPrefix, openCategoryMgr, saveCategory, editCategory, deleteCategory, exportData, importData,
          openRepairRecord, openRepairEditor, saveRepair,
          toggleProductSelection, batchDeleteProducts, batchUpdateProducts,
          toggleCustomerSelection, batchDeleteCustomers,
          toggleBatchProductSelection, addSelectedProducts,
          onRefresh,
          onPickCustCategory, onPickCreditLevel, openCustCategoryMgr, saveCustCategory,
          onPickBatchCategory,
          getCreditLevelColor, getCreditLevelText, getCreditLevelBadge,
          customerCategories, showCustCategoryPicker, showCreditLevelPicker, showCustCategoryMgr, custCategoryForm,
          showBatchEditDialog, showBatchCategoryPicker, batchForm,
          statsActiveTab, categoryStats, customerCategoryStats, creditStats, orderStats,
          loadStatsData, initPie, initPieChart, initOrderTrendChart, initCategoryChart, initCustomerCategoryChart, initCreditChart,
          topCustomers, reportTypeText, dateRangeText, dataTypeText, showReportTypePicker, showDatePicker, showDataTypePicker, reportLoading, customReportData,
          generateCustomReport, exportCustomReport, exportPDF,
          autoBackupEnabled, backupInterval, backupLoading, lastBackupTime, backupHistory, showRestoreDialog,
          createBackup, restoreBackup,
          initIncomeTrendChart, initTurnoverChart,
          touchFeedbackEnabled, gestureEnabled,
          setupTouchFeedback, setupGestureSupport, optimizeMobileNavigation, showGestureHint,
          showGlobalSearch, globalSearchText, searchResults, searchLoading, performGlobalSearch, openSearchResult,
          notificationCount, notifications, showNotificationPanel, loadNotifications, loadAllNotifications, markNotificationAsRead, markAllNotificationsAsRead,
          operationLogs, showOperationLogs, loadOperationLogs
        };
      }
    }).use(vant).mount("#app");
    // ç¦ç”¨Cloudflare Insights
    window['__cfBeacon'] = function(){};
  </script>
</body>
</html>`;
    return new Response(html, { headers: { "content-type": "text/html;charset=UTF-8" } });
  }
};
/* eslint-enable */
